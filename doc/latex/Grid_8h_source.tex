\hypertarget{Grid_8h_source}{}\doxysection{Grid.\+h}
\label{Grid_8h_source}\index{Grid.h@{Grid.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef CRPROPA\_GRID\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define CRPROPA\_GRID\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}crpropa/Referenced.h"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}crpropa/Vector3.h"{}}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}kiss/string.h"{}}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}kiss/logger.h"{}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <type\_traits>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#if HAVE\_SIMD}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <immintrin.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <smmintrin.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// HAVE\_SIMD}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecrpropa}{crpropa}} \{}
\DoxyCodeLine{18 }
\DoxyCodeLine{22 \textcolor{keyword}{enum} \mbox{\hyperlink{namespacecrpropa_aa197adf50cede38157e51842d7a713f8}{interpolationType}} \{}
\DoxyCodeLine{23   TRILINEAR = 0,}
\DoxyCodeLine{24   TRICUBIC,}
\DoxyCodeLine{25   NEAREST\_NEIGHBOUR}
\DoxyCodeLine{26 \};}
\DoxyCodeLine{27 }
\DoxyCodeLine{29 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespacecrpropa_a40c64acf5922cfe05f6b5a82d008b201}{periodicClamp}}(\textcolor{keywordtype}{double} x, \textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} \&lo, \textcolor{keywordtype}{int} \&hi) \{}
\DoxyCodeLine{30         lo = ((int(floor(x)) \% (n)) + (n)) \% (n);}
\DoxyCodeLine{31         hi = (lo + 1) \% (n);}
\DoxyCodeLine{32 \}}
\DoxyCodeLine{33 }
\DoxyCodeLine{35 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(\textcolor{keywordtype}{int} index, \textcolor{keywordtype}{int} n) \{}
\DoxyCodeLine{36         \textcolor{keywordflow}{while} ((index < -\/0.5) or (index > (n-\/0.5)))}
\DoxyCodeLine{37                 index = 2 * n * (index > (n-\/0.5)) -\/ index-\/1;}
\DoxyCodeLine{38         \textcolor{keywordflow}{return} index;}
\DoxyCodeLine{39 \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{42 \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(\textcolor{keywordtype}{int} index, \textcolor{keywordtype}{int} n) \{}
\DoxyCodeLine{43         \textcolor{keywordflow}{return} ((index \% (n)) + (n)) \% (n);}
\DoxyCodeLine{44 \}}
\DoxyCodeLine{45 }
\DoxyCodeLine{47 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespacecrpropa_ace22026777085984c6892b1fe629ec13}{reflectiveClamp}}(\textcolor{keywordtype}{double} x, \textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} \&lo, \textcolor{keywordtype}{int} \&hi, \textcolor{keywordtype}{double} \&res) \{}
\DoxyCodeLine{48         \textcolor{keywordflow}{while} ((x < -\/0.5) or (x > (n-\/0.5)))}
\DoxyCodeLine{49                 x = 2 * n * (x > (n-\/0.5)) -\/x-\/1;}
\DoxyCodeLine{50         res = x;}
\DoxyCodeLine{51         lo = floor(x);}
\DoxyCodeLine{52         hi = lo + (lo < n-\/1);}
\DoxyCodeLine{53         \textcolor{keywordflow}{if} (x<0) \{}
\DoxyCodeLine{54                 lo=0; }
\DoxyCodeLine{55                 hi=0;}
\DoxyCodeLine{56         \}}
\DoxyCodeLine{57 \}}
\DoxyCodeLine{58 }
\DoxyCodeLine{60 \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(\textcolor{keywordtype}{double} r) \{}
\DoxyCodeLine{61         \textcolor{keywordflow}{return} (r > 0.0) ? floor(r + 0.5) : ceil(r -\/ 0.5);}
\DoxyCodeLine{62 \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{73 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1GridProperties}{GridProperties}}: \textcolor{keyword}{public} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}} \{}
\DoxyCodeLine{74 \textcolor{keyword}{public}:}
\DoxyCodeLine{75         \textcolor{keywordtype}{size\_t} Nx, Ny, Nz;      \textcolor{comment}{// Number of grid points}}
\DoxyCodeLine{76         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin;        \textcolor{comment}{// Position of the lower left front corner of the volume}}
\DoxyCodeLine{77         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing;       \textcolor{comment}{// Spacing vector between gridpoints}}
\DoxyCodeLine{78         \textcolor{keywordtype}{bool} reflective;        \textcolor{comment}{// using reflective repetition of the grid instead of periodic}}
\DoxyCodeLine{79         \mbox{\hyperlink{namespacecrpropa_aa197adf50cede38157e51842d7a713f8}{interpolationType}} ipol;        \textcolor{comment}{// Interpolation tpye used between grid points}}
\DoxyCodeLine{80 }
\DoxyCodeLine{86         \mbox{\hyperlink{classcrpropa_1_1GridProperties_a3b2624b5214bc9996e35179eaa2bc9d5}{GridProperties}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} N, \textcolor{keywordtype}{double} spacing) :}
\DoxyCodeLine{87                 origin(origin), Nx(N), Ny(N), Nz(N), spacing(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}}(spacing)), reflective(false), ipol(TRILINEAR) \{}
\DoxyCodeLine{88         \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{97         \mbox{\hyperlink{classcrpropa_1_1GridProperties_a622ec1af11c537544172d48dda459854}{GridProperties}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \textcolor{keywordtype}{double} spacing) :}
\DoxyCodeLine{98                 origin(origin), Nx(Nx), Ny(Ny), Nz(Nz), spacing(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}}(spacing)), reflective(false), ipol(TRILINEAR) \{}
\DoxyCodeLine{99         \}}
\DoxyCodeLine{100 }
\DoxyCodeLine{108         \mbox{\hyperlink{classcrpropa_1_1GridProperties_a7f7fed3252087e112219e972e04e073b}{GridProperties}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing) :}
\DoxyCodeLine{109                 origin(origin), Nx(Nx), Ny(Ny), Nz(Nz), spacing(spacing), reflective(false), ipol(TRILINEAR) \{}
\DoxyCodeLine{110         \}}
\DoxyCodeLine{111         }
\DoxyCodeLine{112         \textcolor{keyword}{virtual} \mbox{\hyperlink{classcrpropa_1_1GridProperties}{\string~GridProperties}}() \{}
\DoxyCodeLine{113         \}}
\DoxyCodeLine{114         }
\DoxyCodeLine{116         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1GridProperties_a9d7fa3fa7ac31401e05efab21c1997ac}{setReflective}}(\textcolor{keywordtype}{bool} b) \{}
\DoxyCodeLine{117                 reflective = b;}
\DoxyCodeLine{118         \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{122         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1GridProperties_ae4e282a433bbb0124c69020fce92e069}{setInterpolationType}}(\mbox{\hyperlink{namespacecrpropa_aa197adf50cede38157e51842d7a713f8}{interpolationType}} i)\{}
\DoxyCodeLine{123                 ipol = i;}
\DoxyCodeLine{124         \}}
\DoxyCodeLine{125 \};}
\DoxyCodeLine{126 }
\DoxyCodeLine{136 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{137 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1Grid}{Grid}}: \textcolor{keyword}{public} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}} \{}
\DoxyCodeLine{138         std::vector<T> grid;}
\DoxyCodeLine{139         \textcolor{keywordtype}{size\_t} Nx, Ny, Nz; }
\DoxyCodeLine{140         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin; }
\DoxyCodeLine{141         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} gridOrigin; }
\DoxyCodeLine{142         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing; }
\DoxyCodeLine{143         \textcolor{keywordtype}{bool} reflective; }
\DoxyCodeLine{144         \mbox{\hyperlink{namespacecrpropa_aa197adf50cede38157e51842d7a713f8}{interpolationType}} ipolType; }
\DoxyCodeLine{146 \textcolor{keyword}{public}:}
\DoxyCodeLine{152         \mbox{\hyperlink{classcrpropa_1_1Grid_a0ae514128f317c586dda8044544128b4}{Grid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} N, \textcolor{keywordtype}{double} spacing) \{}
\DoxyCodeLine{153                 setOrigin(origin);}
\DoxyCodeLine{154                 \mbox{\hyperlink{classcrpropa_1_1Grid_ad2363ad78ab79c80581aa4bbf478d99f}{setGridSize}}(N, N, N);}
\DoxyCodeLine{155                 setSpacing(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}}(spacing));}
\DoxyCodeLine{156                 setReflective(\textcolor{keyword}{false});}
\DoxyCodeLine{157         \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{166         \mbox{\hyperlink{classcrpropa_1_1Grid_a7d881f654805fd38d0801bdcc855002c}{Grid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \textcolor{keywordtype}{double} spacing) \{}
\DoxyCodeLine{167                 setOrigin(origin);}
\DoxyCodeLine{168                 \mbox{\hyperlink{classcrpropa_1_1Grid_ad2363ad78ab79c80581aa4bbf478d99f}{setGridSize}}(Nx, Ny, Nz);}
\DoxyCodeLine{169                 setSpacing(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}}(spacing));}
\DoxyCodeLine{170                 setReflective(\textcolor{keyword}{false});}
\DoxyCodeLine{171         \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{180         \mbox{\hyperlink{classcrpropa_1_1Grid_acbf505c1a493906b3e7038e54d9c6ac1}{Grid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing) \{}
\DoxyCodeLine{181                 setOrigin(origin);}
\DoxyCodeLine{182                 \mbox{\hyperlink{classcrpropa_1_1Grid_ad2363ad78ab79c80581aa4bbf478d99f}{setGridSize}}(Nx, Ny, Nz);}
\DoxyCodeLine{183                 setSpacing(spacing);}
\DoxyCodeLine{184                 setReflective(\textcolor{keyword}{false});}
\DoxyCodeLine{185         \}}
\DoxyCodeLine{186 }
\DoxyCodeLine{190         \mbox{\hyperlink{classcrpropa_1_1Grid_acf906e7df3e88d490278caaae2554d28}{Grid}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1GridProperties}{GridProperties}} \&p) :}
\DoxyCodeLine{191                 origin(p.origin), spacing(p.spacing), reflective(p.reflective), ipolType(p.ipol) \{}
\DoxyCodeLine{192                 \mbox{\hyperlink{classcrpropa_1_1Grid_ad2363ad78ab79c80581aa4bbf478d99f}{setGridSize}}(p.Nx, p.Ny, p.Nz);}
\DoxyCodeLine{193         \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195         \textcolor{keywordtype}{void} setOrigin(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin) \{}
\DoxyCodeLine{196                 this-\/>origin = origin;}
\DoxyCodeLine{197                 this-\/>gridOrigin = origin + spacing/2;}
\DoxyCodeLine{198         \}}
\DoxyCodeLine{199 }
\DoxyCodeLine{201         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1Grid_ad2363ad78ab79c80581aa4bbf478d99f}{setGridSize}}(\textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz) \{}
\DoxyCodeLine{202                 this-\/>Nx = Nx;}
\DoxyCodeLine{203                 this-\/>Ny = Ny;}
\DoxyCodeLine{204                 this-\/>Nz = Nz;}
\DoxyCodeLine{205                 grid.resize(Nx * Ny * Nz);}
\DoxyCodeLine{206                 setOrigin(origin);}
\DoxyCodeLine{207         \}}
\DoxyCodeLine{208 }
\DoxyCodeLine{209         \textcolor{keywordtype}{void} setSpacing(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing) \{}
\DoxyCodeLine{210                 this-\/>spacing = spacing;}
\DoxyCodeLine{211                 setOrigin(origin);}
\DoxyCodeLine{212         \}}
\DoxyCodeLine{213 }
\DoxyCodeLine{214         \textcolor{keywordtype}{void} setReflective(\textcolor{keywordtype}{bool} b) \{}
\DoxyCodeLine{215                 reflective = b;}
\DoxyCodeLine{216         \}}
\DoxyCodeLine{217 }
\DoxyCodeLine{220         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1Grid_a4f606d425b648707871e1f7493fa0275}{setInterpolationType}}(\mbox{\hyperlink{namespacecrpropa_aa197adf50cede38157e51842d7a713f8}{interpolationType}} ipolType) \{}
\DoxyCodeLine{221                 \textcolor{keywordflow}{if} (ipolType == TRILINEAR || ipolType == TRICUBIC || ipolType == NEAREST\_NEIGHBOUR) \{}
\DoxyCodeLine{222                         this-\/>ipolType = ipolType;}
\DoxyCodeLine{223                         \textcolor{keywordflow}{if} ((ipolType == TRICUBIC) \&\& (std::is\_same<T, Vector3d>::value))\{}
\DoxyCodeLine{224                                 KISS\_LOG\_WARNING << \textcolor{stringliteral}{"{}Tricubic interpolation on Grid3d works only with float-\/precision, doubles will be downcasted"{}};}
\DoxyCodeLine{225                 \}}
\DoxyCodeLine{226                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{227                         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}InterpolationType: unknown interpolation type"{}});}
\DoxyCodeLine{228                 \}}
\DoxyCodeLine{229         \}}
\DoxyCodeLine{230 }
\DoxyCodeLine{232         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} \mbox{\hyperlink{classcrpropa_1_1Grid_a5c6a870c843b028952296b9a186382e8}{getOrigin}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{233                 \textcolor{keywordflow}{return} origin;}
\DoxyCodeLine{234         \}}
\DoxyCodeLine{235 }
\DoxyCodeLine{236         \textcolor{keywordtype}{size\_t} getNx()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{237                 \textcolor{keywordflow}{return} Nx;}
\DoxyCodeLine{238         \}}
\DoxyCodeLine{239 }
\DoxyCodeLine{240         \textcolor{keywordtype}{size\_t} getNy()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{241                 \textcolor{keywordflow}{return} Ny;}
\DoxyCodeLine{242         \}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244         \textcolor{keywordtype}{size\_t} getNz()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{245                 \textcolor{keywordflow}{return} Nz;}
\DoxyCodeLine{246         \}}
\DoxyCodeLine{247 }
\DoxyCodeLine{249         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classcrpropa_1_1Grid_a8724a0302f115e2f7336b005eae4125e}{getSizeOf}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{250                 \textcolor{keywordflow}{return} \textcolor{keyword}{sizeof}(grid) + (\textcolor{keyword}{sizeof}(grid[0]) * grid.size());}
\DoxyCodeLine{251         \}}
\DoxyCodeLine{252 }
\DoxyCodeLine{253         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} getSpacing()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{254                 \textcolor{keywordflow}{return} spacing;}
\DoxyCodeLine{255         \}}
\DoxyCodeLine{256 }
\DoxyCodeLine{257         \textcolor{keywordtype}{bool} isReflective()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{258                 \textcolor{keywordflow}{return} reflective;}
\DoxyCodeLine{259         \}}
\DoxyCodeLine{260 }
\DoxyCodeLine{264         T \mbox{\hyperlink{classcrpropa_1_1Grid_a9ca57a57a07cf49c465795e958f0040f}{interpolate}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} \&position) \{}
\DoxyCodeLine{265         \textcolor{keywordflow}{if} (ipolType == TRICUBIC)}
\DoxyCodeLine{266                 \textcolor{keywordflow}{return} tricubicInterpolate(T(), position);}
\DoxyCodeLine{267         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ipolType == NEAREST\_NEIGHBOUR)}
\DoxyCodeLine{268                 \textcolor{keywordflow}{return} \mbox{\hyperlink{classcrpropa_1_1Grid_aa325543483cdaee1bfdf0fb714dd5c90}{closestValue}}(position);}
\DoxyCodeLine{269         \textcolor{keywordflow}{else}}
\DoxyCodeLine{270                 \textcolor{keywordflow}{return} trilinearInterpolate(position);}
\DoxyCodeLine{271         \}}
\DoxyCodeLine{272 }
\DoxyCodeLine{274         T \&\mbox{\hyperlink{classcrpropa_1_1Grid_a6c72c88c23abb6788c60edc727e85bb6}{get}}(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz) \{}
\DoxyCodeLine{275                 \textcolor{keywordflow}{return} grid[ix * Ny * Nz + iy * Nz + iz];}
\DoxyCodeLine{276         \}}
\DoxyCodeLine{277 }
\DoxyCodeLine{279         \textcolor{keyword}{const} T \&\mbox{\hyperlink{classcrpropa_1_1Grid_a3ec39ecd1ecb9e4beb9b9e581945d842}{get}}(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{280                 \textcolor{keywordflow}{return} grid[ix * Ny * Nz + iy * Nz + iz];}
\DoxyCodeLine{281         \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283         \textcolor{keyword}{const} T \&periodicGet(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{284                 ix = \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(ix, Nx);}
\DoxyCodeLine{285                 iy = \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(iy, Ny);}
\DoxyCodeLine{286                 iz = \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(iz, Nz);}
\DoxyCodeLine{287                 \textcolor{keywordflow}{return} grid[ix * Ny * Nz + iy * Nz + iz];}
\DoxyCodeLine{288         \}}
\DoxyCodeLine{289 }
\DoxyCodeLine{290         \textcolor{keyword}{const} T \&reflectiveGet(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{291                 ix = \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(ix, Nx);}
\DoxyCodeLine{292                 iy = \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(iy, Ny);}
\DoxyCodeLine{293                 iz = \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(iz, Nz);}
\DoxyCodeLine{294                 \textcolor{keywordflow}{return} grid[ix * Ny * Nz + iy * Nz + iz];}
\DoxyCodeLine{295         \}}
\DoxyCodeLine{296 }
\DoxyCodeLine{297         T getValue(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz) \{}
\DoxyCodeLine{298                 \textcolor{keywordflow}{return} grid[ix * Ny * Nz + iy * Nz + iz];}
\DoxyCodeLine{299         \}}
\DoxyCodeLine{300 }
\DoxyCodeLine{301         \textcolor{keywordtype}{void} setValue(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz, T value) \{}
\DoxyCodeLine{302                 grid[ix * Ny * Nz + iy * Nz + iz] = value;}
\DoxyCodeLine{303         \}}
\DoxyCodeLine{304 }
\DoxyCodeLine{306         std::vector<T> \&\mbox{\hyperlink{classcrpropa_1_1Grid_ab93dfd01fd98e3d1a868e49767b48d26}{getGrid}}() \{}
\DoxyCodeLine{307                 \textcolor{keywordflow}{return} grid;}
\DoxyCodeLine{308         \}}
\DoxyCodeLine{309 }
\DoxyCodeLine{311         \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} \mbox{\hyperlink{classcrpropa_1_1Grid_a676dd62078b7146cf6024ead49f6540b}{positionFromIndex}}(\textcolor{keywordtype}{int} index)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{312                 \textcolor{keywordtype}{int} ix = index / (Ny * Nz);}
\DoxyCodeLine{313                 \textcolor{keywordtype}{int} iy = (index / Nz) \% Ny;}
\DoxyCodeLine{314                 \textcolor{keywordtype}{int} iz = index \% Nz;}
\DoxyCodeLine{315                 \textcolor{keywordflow}{return} \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}}(ix, iy, iz) * spacing + gridOrigin;}
\DoxyCodeLine{316         \}}
\DoxyCodeLine{317 }
\DoxyCodeLine{319         T \mbox{\hyperlink{classcrpropa_1_1Grid_aa325543483cdaee1bfdf0fb714dd5c90}{closestValue}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} \&position)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{320                 \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} r = (position -\/ gridOrigin) / spacing;}
\DoxyCodeLine{321                 \textcolor{keywordtype}{int} ix, iy, iz;}
\DoxyCodeLine{322                 \textcolor{keywordflow}{if} (reflective) \{}
\DoxyCodeLine{323                         ix = \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(r.x);}
\DoxyCodeLine{324                         iy = \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(r.y);}
\DoxyCodeLine{325                         iz = \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(r.z);}
\DoxyCodeLine{326                         \textcolor{keywordflow}{while} ((ix < -\/0.5) or (ix > (Nx-\/0.5)))}
\DoxyCodeLine{327                                 ix = 2 * Nx * (ix > (Nx-\/0.5)) -\/ ix-\/1;}
\DoxyCodeLine{328                         \textcolor{keywordflow}{while} ((iy < -\/0.5) or (iy > (Ny-\/0.5)))}
\DoxyCodeLine{329                                 iy = 2 * Ny * (iy > (Ny-\/0.5)) -\/ iy-\/1;}
\DoxyCodeLine{330                         \textcolor{keywordflow}{while} ((iz < -\/0.5) or (iz > (Nz-\/0.5)))}
\DoxyCodeLine{331                                 iz = 2 * Nz * (iz > (Nz-\/0.5)) -\/ iz-\/1;}
\DoxyCodeLine{332                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{333                         ix = \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(fmod(r.x, Nx));}
\DoxyCodeLine{334                         iy = \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(fmod(r.y, Ny));}
\DoxyCodeLine{335                         iz = \mbox{\hyperlink{namespacecrpropa_afdfae60dd4680363c4a98a60d4b087b6}{round}}(fmod(r.z, Nz));}
\DoxyCodeLine{336                         ix = (ix + Nx * (ix < 0)) \% Nx;}
\DoxyCodeLine{337                         iy = (iy + Ny * (iy < 0)) \% Ny;}
\DoxyCodeLine{338                         iz = (iz + Nz * (iz < 0)) \% Nz;}
\DoxyCodeLine{339                 \}}
\DoxyCodeLine{340                 \textcolor{keywordflow}{return} \mbox{\hyperlink{classcrpropa_1_1Grid_a6c72c88c23abb6788c60edc727e85bb6}{get}}(ix, iy, iz);}
\DoxyCodeLine{341         \}}
\DoxyCodeLine{342 }
\DoxyCodeLine{343 \textcolor{keyword}{private}:}
\DoxyCodeLine{344 \textcolor{preprocessor}{        \#ifdef HAVE\_SIMD}}
\DoxyCodeLine{345         \_\_m128 simdperiodicGet(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{346                 ix = \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(ix, Nx);}
\DoxyCodeLine{347                 iy = \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(iy, Ny);}
\DoxyCodeLine{348                 iz = \mbox{\hyperlink{namespacecrpropa_ae8add7f940570a0e49a13093314654aa}{periodicBoundary}}(iz, Nz);}
\DoxyCodeLine{349                 \textcolor{keywordflow}{return} convertVector3fToSimd(grid[ix * Ny * Nz + iy * Nz + iz]);}
\DoxyCodeLine{350         \}}
\DoxyCodeLine{351 }
\DoxyCodeLine{352         \_\_m128 simdreflectiveGet(\textcolor{keywordtype}{size\_t} ix, \textcolor{keywordtype}{size\_t} iy, \textcolor{keywordtype}{size\_t} iz)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{353                 ix = \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(ix, Nx);}
\DoxyCodeLine{354                 iy = \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(iy, Ny);}
\DoxyCodeLine{355                 iz = \mbox{\hyperlink{namespacecrpropa_a42f2bb65aca43e8defb9d7a922814c7f}{reflectiveBoundary}}(iz, Nz);}
\DoxyCodeLine{356                 \textcolor{keywordflow}{return} convertVector3fToSimd(grid[ix * Ny * Nz + iy * Nz + iz]);}
\DoxyCodeLine{357         \}}
\DoxyCodeLine{358 }
\DoxyCodeLine{359         \_\_m128 convertVector3fToSimd(\textcolor{keyword}{const} Vector3f v)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{360                 \_\_m128 simdVar = \_mm\_set\_ps(0,v.z,v.y,v.x);}
\DoxyCodeLine{361                 \textcolor{keywordflow}{return} simdVar;}
\DoxyCodeLine{362         \}}
\DoxyCodeLine{363         }
\DoxyCodeLine{364         Vector3f convertSimdToVector3f(\_\_m128 res)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{365                 \textcolor{keywordtype}{float} vec[4];   }
\DoxyCodeLine{366                 \_mm\_store\_ps(\&vec[0], res);}
\DoxyCodeLine{367                 Vector3f result = Vector3f(vec[0], vec[1], vec[2]);}
\DoxyCodeLine{368                 \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{369         \}}
\DoxyCodeLine{370 }
\DoxyCodeLine{372         \_\_m128 CubicInterpolate(\_\_m128 p0,\_\_m128 p1,\_\_m128 p2,\_\_m128 p3,\textcolor{keywordtype}{double} position)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{373                 \_\_m128 c1 = \_mm\_set1\_ps (1/2.);}
\DoxyCodeLine{374                 \_\_m128 c2 = \_mm\_set1\_ps (3/2.);}
\DoxyCodeLine{375                 \_\_m128 c3 = \_mm\_set1\_ps (2.);}
\DoxyCodeLine{376                 \_\_m128 c4 = \_mm\_set1\_ps (5/2.);}
\DoxyCodeLine{377 }
\DoxyCodeLine{378                 \_\_m128 pos  = \_mm\_set1\_ps (position);}
\DoxyCodeLine{379                 \_\_m128 pos2 = \_mm\_set1\_ps (position*position);}
\DoxyCodeLine{380                 \_\_m128 pos3 = \_mm\_set1\_ps (position*position*position);}
\DoxyCodeLine{381 }
\DoxyCodeLine{387                 \_\_m128 term = \_mm\_mul\_ps(\_mm\_sub\_ps(\_mm\_mul\_ps(c1,p2),\_mm\_mul\_ps(c1,p0)),pos);}
\DoxyCodeLine{388                 \_\_m128 term2 = \_mm\_mul\_ps(\_mm\_sub\_ps(\_mm\_add\_ps(p0,\_mm\_mul\_ps(c3,p2)),\_mm\_add\_ps(\_mm\_mul\_ps(c4,p1),\_mm\_mul\_ps(c1,p3))),pos2);}
\DoxyCodeLine{389                 \_\_m128 term3 = \_mm\_mul\_ps(\_mm\_sub\_ps(\_mm\_add\_ps(\_mm\_mul\_ps(c2,p1),\_mm\_mul\_ps(c1,p3)),\_mm\_add\_ps(\_mm\_mul\_ps(c1,p0),\_mm\_mul\_ps(c2,p2))),pos3);}
\DoxyCodeLine{390                 \_\_m128 res = \_mm\_add\_ps(\_mm\_add\_ps(\_mm\_add\_ps(term3,term2),term),p1);}
\DoxyCodeLine{391                 \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{392         \}}
\DoxyCodeLine{393 \textcolor{preprocessor}{        \#endif }\textcolor{comment}{// HAVE\_SIMD}}
\DoxyCodeLine{395 \textcolor{comment}{}        Vector3f tricubicInterpolate(Vector3f, const Vector3d \&position) const \{}
\DoxyCodeLine{396 \textcolor{preprocessor}{                \#ifdef HAVE\_SIMD}}
\DoxyCodeLine{397                 \textcolor{comment}{// position on a unit grid}}
\DoxyCodeLine{398                 Vector3d r = (position -\/ gridOrigin) / spacing;}
\DoxyCodeLine{399 }
\DoxyCodeLine{400                 \textcolor{keywordtype}{int} iX0, iY0, iZ0;}
\DoxyCodeLine{401                 iX0 = floor(r.x);}
\DoxyCodeLine{402                 iY0 = floor(r.y);}
\DoxyCodeLine{403                 iZ0 = floor(r.z);}
\DoxyCodeLine{404 }
\DoxyCodeLine{405                 \textcolor{keywordtype}{double} fX, fY, fZ;}
\DoxyCodeLine{406                 fX = r.x -\/ iX0;}
\DoxyCodeLine{407                 fY = r.y -\/ iY0;}
\DoxyCodeLine{408                 fZ = r.z -\/ iZ0;}
\DoxyCodeLine{409 }
\DoxyCodeLine{410                 \textcolor{keywordtype}{int} nrCubicInterpolations = 4;}
\DoxyCodeLine{411                 \_\_m128 interpolateVaryX[nrCubicInterpolations];}
\DoxyCodeLine{412                 \_\_m128 interpolateVaryY[nrCubicInterpolations];}
\DoxyCodeLine{413                 \_\_m128 interpolateVaryZ[nrCubicInterpolations];}
\DoxyCodeLine{415                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iLoopX = -\/1; iLoopX < nrCubicInterpolations-\/1; iLoopX++) \{}
\DoxyCodeLine{416                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iLoopY = -\/1; iLoopY < nrCubicInterpolations-\/1; iLoopY++) \{}
\DoxyCodeLine{417                                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iLoopZ = -\/1; iLoopZ < nrCubicInterpolations-\/1; iLoopZ++) \{}
\DoxyCodeLine{418                                         \textcolor{keywordflow}{if} (reflective)}
\DoxyCodeLine{419                                                 interpolateVaryZ[iLoopZ+1] = simdreflectiveGet(iX0+iLoopX, iY0+iLoopY, iZ0+iLoopZ);}
\DoxyCodeLine{420                                         \textcolor{keywordflow}{else} }
\DoxyCodeLine{421                                                 interpolateVaryZ[iLoopZ+1] = simdperiodicGet(iX0+iLoopX, iY0+iLoopY, iZ0+iLoopZ);}
\DoxyCodeLine{422                                 \}}
\DoxyCodeLine{423                                 interpolateVaryY[iLoopY+1] = CubicInterpolate(interpolateVaryZ[0], interpolateVaryZ[1], interpolateVaryZ[2], interpolateVaryZ[3], fZ);}
\DoxyCodeLine{424                         \}}
\DoxyCodeLine{425                         interpolateVaryX[iLoopX+1] = CubicInterpolate(interpolateVaryY[0], interpolateVaryY[1], interpolateVaryY[2], interpolateVaryY[3], fY);}
\DoxyCodeLine{426                 \}}
\DoxyCodeLine{427                 \_\_m128 result = CubicInterpolate(interpolateVaryX[0], interpolateVaryX[1], interpolateVaryX[2], interpolateVaryX[3], fX);}
\DoxyCodeLine{428                 \textcolor{keywordflow}{return} convertSimdToVector3f(result);}
\DoxyCodeLine{429 \textcolor{preprocessor}{                \#else }\textcolor{comment}{// HAVE\_SIMD}}
\DoxyCodeLine{430                 \textcolor{keywordflow}{throw} std::runtime\_error( \textcolor{stringliteral}{"{}Tried to use tricubic Interpolation without SIMD\_EXTENSION. SIMD Optimization is neccesary for tricubic interpolation of vector grids.\(\backslash\)n"{}});}
\DoxyCodeLine{431 \textcolor{preprocessor}{                \#endif }\textcolor{comment}{// HAVE\_SIMD     }}
\DoxyCodeLine{432         \}}
\DoxyCodeLine{433 }
\DoxyCodeLine{435         \textcolor{keywordtype}{double} CubicInterpolateScalar(\textcolor{keywordtype}{double} p0,\textcolor{keywordtype}{double} p1,\textcolor{keywordtype}{double} p2,\textcolor{keywordtype}{double} p3,\textcolor{keywordtype}{double} pos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{436                 \textcolor{keywordflow}{return}((-\/0.5*p0+3/2.*p1-\/3/2.*p2+0.5*p3)*pos*pos*pos+(p0-\/5/2.*p1+p2*2-\/0.5*p3)*pos*pos+(-\/0.5*p0+0.5*p2)*pos+p1);}
\DoxyCodeLine{437         \}}
\DoxyCodeLine{438 }
\DoxyCodeLine{440         \textcolor{keywordtype}{double} tricubicInterpolate(\textcolor{keywordtype}{double}, \textcolor{keyword}{const} Vector3d \&position)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{442                 Vector3d r = (position -\/ gridOrigin) / spacing;}
\DoxyCodeLine{443 }
\DoxyCodeLine{444                 \textcolor{keywordtype}{int} iX0, iY0, iZ0;}
\DoxyCodeLine{445                 iX0 = floor(r.x);}
\DoxyCodeLine{446                 iY0 = floor(r.y);}
\DoxyCodeLine{447                 iZ0 = floor(r.z);}
\DoxyCodeLine{448 }
\DoxyCodeLine{449                 \textcolor{keywordtype}{double} fX, fY, fZ;}
\DoxyCodeLine{450                 fX = r.x -\/ iX0;}
\DoxyCodeLine{451                 fY = r.y -\/ iY0;}
\DoxyCodeLine{452                 fZ = r.z -\/ iZ0;}
\DoxyCodeLine{453 }
\DoxyCodeLine{454                 \textcolor{keywordtype}{int} nrCubicInterpolations = 4;}
\DoxyCodeLine{455                 \textcolor{keywordtype}{double} interpolateVaryX[nrCubicInterpolations];}
\DoxyCodeLine{456                 \textcolor{keywordtype}{double} interpolateVaryY[nrCubicInterpolations];}
\DoxyCodeLine{457                 \textcolor{keywordtype}{double} interpolateVaryZ[nrCubicInterpolations];}
\DoxyCodeLine{459                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iLoopX = -\/1; iLoopX < nrCubicInterpolations-\/1; iLoopX++) \{}
\DoxyCodeLine{460                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iLoopY = -\/1; iLoopY < nrCubicInterpolations-\/1; iLoopY++) \{}
\DoxyCodeLine{461                                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} iLoopZ = -\/1; iLoopZ < nrCubicInterpolations-\/1; iLoopZ++) \{}
\DoxyCodeLine{462                                         \textcolor{keywordflow}{if} (reflective)}
\DoxyCodeLine{463                                                 interpolateVaryZ[iLoopZ+1] = reflectiveGet(iX0+iLoopX, iY0+iLoopY, iZ0+iLoopZ);}
\DoxyCodeLine{464                                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{465                                                 interpolateVaryZ[iLoopZ+1] = periodicGet(iX0+iLoopX, iY0+iLoopY, iZ0+iLoopZ);}
\DoxyCodeLine{466                                 \}}
\DoxyCodeLine{467                                 interpolateVaryY[iLoopY+1] = CubicInterpolateScalar(interpolateVaryZ[0], interpolateVaryZ[1], interpolateVaryZ[2], interpolateVaryZ[3], fZ);}
\DoxyCodeLine{468                         \}}
\DoxyCodeLine{469                         interpolateVaryX[iLoopX+1] = CubicInterpolateScalar(interpolateVaryY[0], interpolateVaryY[1], interpolateVaryY[2], interpolateVaryY[3], fY);}
\DoxyCodeLine{470                 \}}
\DoxyCodeLine{471                 \textcolor{keywordtype}{double} result = CubicInterpolateScalar(interpolateVaryX[0], interpolateVaryX[1], interpolateVaryX[2], interpolateVaryX[3], fX);}
\DoxyCodeLine{472                 \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{473         \}}
\DoxyCodeLine{474 }
\DoxyCodeLine{476         T trilinearInterpolate(\textcolor{keyword}{const} Vector3d \&position)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{478                 Vector3d r = (position -\/ gridOrigin) / spacing;}
\DoxyCodeLine{479 }
\DoxyCodeLine{482                 \textcolor{keywordtype}{int} iX0, iX1, iY0, iY1, iZ0, iZ1;}
\DoxyCodeLine{483                 \textcolor{keywordtype}{double} resX, resY, resZ, fX0, fY0, fZ0;}
\DoxyCodeLine{484 }
\DoxyCodeLine{485                 \textcolor{keywordflow}{if} (reflective) \{}
\DoxyCodeLine{486                         \mbox{\hyperlink{namespacecrpropa_ace22026777085984c6892b1fe629ec13}{reflectiveClamp}}(r.x, Nx, iX0, iX1, resX);}
\DoxyCodeLine{487                         \mbox{\hyperlink{namespacecrpropa_ace22026777085984c6892b1fe629ec13}{reflectiveClamp}}(r.y, Ny, iY0, iY1, resY);}
\DoxyCodeLine{488                         \mbox{\hyperlink{namespacecrpropa_ace22026777085984c6892b1fe629ec13}{reflectiveClamp}}(r.z, Nz, iZ0, iZ1, resZ);}
\DoxyCodeLine{489                         fX0 = resX -\/ floor(resX);}
\DoxyCodeLine{490                         fY0 = resY -\/ floor(resY);}
\DoxyCodeLine{491                         fZ0 = resZ -\/ floor(resZ);}
\DoxyCodeLine{492                 \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{493                         \mbox{\hyperlink{namespacecrpropa_a40c64acf5922cfe05f6b5a82d008b201}{periodicClamp}}(r.x, Nx, iX0, iX1);}
\DoxyCodeLine{494                         \mbox{\hyperlink{namespacecrpropa_a40c64acf5922cfe05f6b5a82d008b201}{periodicClamp}}(r.y, Ny, iY0, iY1);}
\DoxyCodeLine{495                         \mbox{\hyperlink{namespacecrpropa_a40c64acf5922cfe05f6b5a82d008b201}{periodicClamp}}(r.z, Nz, iZ0, iZ1);}
\DoxyCodeLine{496                         fX0 = r.x -\/ floor(r.x);}
\DoxyCodeLine{497                         fY0 = r.y -\/ floor(r.y);}
\DoxyCodeLine{498                         fZ0 = r.z -\/ floor(r.z);}
\DoxyCodeLine{499                 \}}
\DoxyCodeLine{500 }
\DoxyCodeLine{502                 \textcolor{keywordtype}{double} fX1 = 1 -\/ fX0;}
\DoxyCodeLine{503                 \textcolor{keywordtype}{double} fY1 = 1 -\/ fY0;}
\DoxyCodeLine{504                 \textcolor{keywordtype}{double} fZ1 = 1 -\/ fZ0;}
\DoxyCodeLine{505 }
\DoxyCodeLine{507                 T b(0.);}
\DoxyCodeLine{508                 b += get(iX0, iY0, iZ0) * fX1 * fY1 * fZ1;}
\DoxyCodeLine{509                 b += get(iX1, iY0, iZ0) * fX0 * fY1 * fZ1;}
\DoxyCodeLine{510                 b += get(iX0, iY1, iZ0) * fX1 * fY0 * fZ1;}
\DoxyCodeLine{511                 b += get(iX0, iY0, iZ1) * fX1 * fY1 * fZ0;}
\DoxyCodeLine{512                 b += get(iX1, iY0, iZ1) * fX0 * fY1 * fZ0;}
\DoxyCodeLine{513                 b += get(iX0, iY1, iZ1) * fX1 * fY0 * fZ0;}
\DoxyCodeLine{514                 b += get(iX1, iY1, iZ0) * fX0 * fY0 * fZ1;}
\DoxyCodeLine{515                 b += get(iX1, iY1, iZ1) * fX0 * fY0 * fZ0;}
\DoxyCodeLine{516 }
\DoxyCodeLine{517                 \textcolor{keywordflow}{return} b;}
\DoxyCodeLine{518         \}}
\DoxyCodeLine{519 }
\DoxyCodeLine{520 \}; \textcolor{comment}{// class Grid}}
\DoxyCodeLine{521 }
\DoxyCodeLine{522 \textcolor{keyword}{typedef} Grid<Vector3f> Grid3f;}
\DoxyCodeLine{523 \textcolor{keyword}{typedef} Grid<Vector3d> Grid3d;}
\DoxyCodeLine{524 \textcolor{keyword}{typedef} Grid<float> Grid1f;}
\DoxyCodeLine{525 \textcolor{keyword}{typedef} Grid<double> Grid1d;}
\DoxyCodeLine{526 }
\DoxyCodeLine{527 \textcolor{comment}{// DEPRECATED: Will be removed in CRPropa v3.2}}
\DoxyCodeLine{528 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1VectorGrid}{VectorGrid}}: \textcolor{keyword}{public} \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid3f}} \{}
\DoxyCodeLine{529         \textcolor{keywordtype}{void} printDeprecation()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{530                 KISS\_LOG\_WARNING << \textcolor{stringliteral}{"{}VectorGrid is deprecated and will be removed in the future. Replace it with Grid3f (float) or Grid3d (double)."{}};}
\DoxyCodeLine{531         \}}
\DoxyCodeLine{532 \textcolor{keyword}{public}:}
\DoxyCodeLine{533         \mbox{\hyperlink{classcrpropa_1_1VectorGrid}{VectorGrid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} N, \textcolor{keywordtype}{double} spacing) : \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid3f}}(origin, N, spacing) \{}
\DoxyCodeLine{534                 printDeprecation();}
\DoxyCodeLine{535         \}}
\DoxyCodeLine{536 }
\DoxyCodeLine{537         \mbox{\hyperlink{classcrpropa_1_1VectorGrid}{VectorGrid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \textcolor{keywordtype}{double} spacing) : \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid3f}}(origin, Nx, Ny, Nz, spacing) \{}
\DoxyCodeLine{538                 printDeprecation();}
\DoxyCodeLine{539         \}}
\DoxyCodeLine{540 }
\DoxyCodeLine{541         \mbox{\hyperlink{classcrpropa_1_1VectorGrid}{VectorGrid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing) : \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid3f}}(origin, Nx, Ny, Nz, spacing) \{}
\DoxyCodeLine{542                 printDeprecation();}
\DoxyCodeLine{543         \}}
\DoxyCodeLine{544 \};}
\DoxyCodeLine{545 }
\DoxyCodeLine{546 \textcolor{comment}{// DEPRECATED: Will be removed in CRPropa v3.2}}
\DoxyCodeLine{547 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1ScalarGrid}{ScalarGrid}}: \textcolor{keyword}{public} \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid1f}} \{}
\DoxyCodeLine{548         \textcolor{keywordtype}{void} printDeprecation()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{549                 KISS\_LOG\_WARNING << \textcolor{stringliteral}{"{}ScalarGrid is deprecated and will be removed in the future. Replace with Grid1f (float) or Grid1d (double)."{}};}
\DoxyCodeLine{550         \}}
\DoxyCodeLine{551 \textcolor{keyword}{public}:}
\DoxyCodeLine{552         \mbox{\hyperlink{classcrpropa_1_1ScalarGrid}{ScalarGrid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} N, \textcolor{keywordtype}{double} spacing) : \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid1f}}(origin, N, spacing) \{}
\DoxyCodeLine{553                 printDeprecation();}
\DoxyCodeLine{554         \}}
\DoxyCodeLine{555 }
\DoxyCodeLine{556         \mbox{\hyperlink{classcrpropa_1_1ScalarGrid}{ScalarGrid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \textcolor{keywordtype}{double} spacing) : \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid1f}}(origin, Nx, Ny, Nz, spacing) \{}
\DoxyCodeLine{557                 printDeprecation();}
\DoxyCodeLine{558         \}}
\DoxyCodeLine{559 }
\DoxyCodeLine{560         \mbox{\hyperlink{classcrpropa_1_1ScalarGrid}{ScalarGrid}}(\mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} origin, \textcolor{keywordtype}{size\_t} Nx, \textcolor{keywordtype}{size\_t} Ny, \textcolor{keywordtype}{size\_t} Nz, \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} spacing) : \mbox{\hyperlink{classcrpropa_1_1Grid}{Grid1f}}(origin, Nx, Ny, Nz, spacing) \{}
\DoxyCodeLine{561                 printDeprecation();}
\DoxyCodeLine{562         \}}
\DoxyCodeLine{563 \};}
\DoxyCodeLine{564 }
\DoxyCodeLine{567 \} \textcolor{comment}{// namespace crpropa}}
\DoxyCodeLine{568 }
\DoxyCodeLine{569 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// CRPROPA\_GRID\_H}}

\end{DoxyCode}
