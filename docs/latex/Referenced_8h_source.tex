\hypertarget{Referenced_8h_source}{}\doxysection{Referenced.\+h}
\label{Referenced_8h_source}\index{Referenced.h@{Referenced.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef CRPROPA\_REFERENCED\_H}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define CRPROPA\_REFERENCED\_H}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <typeinfo>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecrpropa}{crpropa}} \{}
\DoxyCodeLine{27 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}} \{}
\DoxyCodeLine{28 \textcolor{keyword}{public}:}
\DoxyCodeLine{29 }
\DoxyCodeLine{30         \textcolor{keyword}{inline} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}}() :}
\DoxyCodeLine{31                         \_referenceCount(0) \{}
\DoxyCodeLine{32         \}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34         \textcolor{keyword}{inline} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}}\&) :}
\DoxyCodeLine{35                         \_referenceCount(0) \{}
\DoxyCodeLine{36         \}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38         \textcolor{keyword}{inline} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}}\& operator =(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}}\&) \{}
\DoxyCodeLine{39                 \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{40         \}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} addReference()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{43                 \textcolor{keywordtype}{int} newRef;}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#if defined(OPENMP\_3\_1)}}
\DoxyCodeLine{45 \textcolor{preprocessor}{                \#pragma omp atomic capture}}
\DoxyCodeLine{46                 \{newRef = \_referenceCount++;\}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#elif defined(\_\_GNUC\_\_)}}
\DoxyCodeLine{48                 newRef = \_\_sync\_add\_and\_fetch(\&\_referenceCount, 1);}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{50 \textcolor{preprocessor}{                \#pragma omp critical}}
\DoxyCodeLine{51                 \{newRef = \_referenceCount++;\}}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{53                 \textcolor{keywordflow}{return} newRef;}
\DoxyCodeLine{54         \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} removeReference()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{58                 \textcolor{keywordflow}{if} (\_referenceCount == 0)}
\DoxyCodeLine{59                         std::cerr}
\DoxyCodeLine{60                                         << \textcolor{stringliteral}{"{}WARNING: Remove reference from Object with NO references: "{}}}
\DoxyCodeLine{61                                         << \textcolor{keyword}{typeid}(*this).name() << std::endl;}
\DoxyCodeLine{62 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{63                 \textcolor{keywordtype}{int} newRef;}
\DoxyCodeLine{64 \textcolor{preprocessor}{\#if defined(OPENMP\_3\_1)}}
\DoxyCodeLine{65 \textcolor{preprocessor}{                \#pragma omp atomic capture}}
\DoxyCodeLine{66                 \{newRef = \_referenceCount-\/-\/;\}}
\DoxyCodeLine{67 \textcolor{preprocessor}{\#elif defined(\_\_GNUC\_\_)}}
\DoxyCodeLine{68                 newRef = \_\_sync\_sub\_and\_fetch(\&\_referenceCount, 1);}
\DoxyCodeLine{69 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{70 \textcolor{preprocessor}{                \#pragma omp critical}}
\DoxyCodeLine{71                 \{newRef = \_referenceCount-\/-\/;\}}
\DoxyCodeLine{72 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74                 \textcolor{keywordflow}{if} (newRef == 0) \{}
\DoxyCodeLine{75                         \textcolor{keyword}{delete} \textcolor{keyword}{this};}
\DoxyCodeLine{76                 \}}
\DoxyCodeLine{77                 \textcolor{keywordflow}{return} newRef;}
\DoxyCodeLine{78         \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80         \textcolor{keywordtype}{int} removeReferenceNoDelete()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{81                 \textcolor{keywordflow}{return} -\/-\/\_referenceCount;}
\DoxyCodeLine{82         \}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} getReferenceCount()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{85                 \textcolor{keywordflow}{return} \_referenceCount;}
\DoxyCodeLine{86         \}}
\DoxyCodeLine{87 }
\DoxyCodeLine{88 \textcolor{keyword}{protected}:}
\DoxyCodeLine{89 }
\DoxyCodeLine{90         \textcolor{keyword}{virtual} \textcolor{keyword}{inline} \mbox{\hyperlink{classcrpropa_1_1Referenced}{\string~Referenced}}() \{}
\DoxyCodeLine{91 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{92                 \textcolor{keywordflow}{if} (\_referenceCount)}
\DoxyCodeLine{93                         std::cerr << \textcolor{stringliteral}{"{}WARNING: Deleting Object with references: "{}}}
\DoxyCodeLine{94                                         << \textcolor{keyword}{typeid}(*this).name() << std::endl;}
\DoxyCodeLine{95 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{96         \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98         \textcolor{keyword}{mutable} \textcolor{keywordtype}{size\_t} \_referenceCount;}
\DoxyCodeLine{99 \};}
\DoxyCodeLine{100 }
\DoxyCodeLine{101 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} intrusive\_ptr\_add\_ref(\mbox{\hyperlink{classcrpropa_1_1Referenced}{Referenced}}* p) \{}
\DoxyCodeLine{102         p-\/>addReference();}
\DoxyCodeLine{103 \}}
\DoxyCodeLine{104 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} intrusive\_ptr\_release(Referenced* p) \{}
\DoxyCodeLine{105         p-\/>removeReference();}
\DoxyCodeLine{106 \}}
\DoxyCodeLine{107 }
\DoxyCodeLine{112 \textcolor{keyword}{template}<\textcolor{keyword}{class} T>}
\DoxyCodeLine{113 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}} \{}
\DoxyCodeLine{114 \textcolor{keyword}{public}:}
\DoxyCodeLine{115         \textcolor{keyword}{typedef} T element\_type;}
\DoxyCodeLine{116 }
\DoxyCodeLine{117         \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}() :}
\DoxyCodeLine{118                         \_ptr(0) \{}
\DoxyCodeLine{119         \}}
\DoxyCodeLine{120         \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}(T* ptr) :}
\DoxyCodeLine{121                         \_ptr(ptr) \{}
\DoxyCodeLine{122                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{123                         \_ptr-\/>addReference();}
\DoxyCodeLine{124         \}}
\DoxyCodeLine{125         \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}\& rp) :}
\DoxyCodeLine{126                         \_ptr(rp.\_ptr) \{}
\DoxyCodeLine{127                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{128                         \_ptr-\/>addReference();}
\DoxyCodeLine{129         \}}
\DoxyCodeLine{130         \textcolor{keyword}{template}<\textcolor{keyword}{class} Other> \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr<Other>}}\& rp) :}
\DoxyCodeLine{131                         \_ptr(rp.\_ptr) \{}
\DoxyCodeLine{132                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{133                         \_ptr-\/>addReference();}
\DoxyCodeLine{134         \}}
\DoxyCodeLine{135 }
\DoxyCodeLine{136         \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{\string~ref\_ptr}}() \{}
\DoxyCodeLine{137                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{138                         \_ptr-\/>removeReference();}
\DoxyCodeLine{139                 \_ptr = 0;}
\DoxyCodeLine{140         \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142         \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}\& operator =(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}\& rp) \{}
\DoxyCodeLine{143                 assign(rp);}
\DoxyCodeLine{144                 \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{145         \}}
\DoxyCodeLine{146 }
\DoxyCodeLine{147         \textcolor{keyword}{template}<\textcolor{keyword}{class} Other> \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}\& operator =(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr<Other>}}\& rp) \{}
\DoxyCodeLine{148                 assign(rp);}
\DoxyCodeLine{149                 \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{150         \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152         \textcolor{keyword}{inline} \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}\& operator =(T* ptr) \{}
\DoxyCodeLine{153                 \textcolor{keywordflow}{if} (\_ptr == ptr)}
\DoxyCodeLine{154                         \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{155                 T* tmp\_ptr = \_ptr;}
\DoxyCodeLine{156                 \_ptr = ptr;}
\DoxyCodeLine{157                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{158                         \_ptr-\/>addReference();}
\DoxyCodeLine{159                 \textcolor{keywordflow}{if} (tmp\_ptr)}
\DoxyCodeLine{160                         tmp\_ptr-\/>removeReference();}
\DoxyCodeLine{161                 \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{162         \}}
\DoxyCodeLine{163 }
\DoxyCodeLine{164         \textcolor{keyword}{operator} T*() \textcolor{keyword}{const} \{}
\DoxyCodeLine{165                 \textcolor{keywordflow}{return} \_ptr;}
\DoxyCodeLine{166         \}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168         T\& operator*()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{169                 \textcolor{keywordflow}{return} *\_ptr;}
\DoxyCodeLine{170         \}}
\DoxyCodeLine{171         T* operator-\/>()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{172                 \textcolor{keywordflow}{return} \_ptr;}
\DoxyCodeLine{173         \}}
\DoxyCodeLine{174         T* get()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{175                 \textcolor{keywordflow}{return} \_ptr;}
\DoxyCodeLine{176         \}}
\DoxyCodeLine{177 }
\DoxyCodeLine{178         \textcolor{keywordtype}{bool} operator!()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{179                 \textcolor{keywordflow}{return} \_ptr == 0;}
\DoxyCodeLine{180         \} \textcolor{comment}{// not required}}
\DoxyCodeLine{181         \textcolor{keywordtype}{bool} valid()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{182                 \textcolor{keywordflow}{return} \_ptr != 0;}
\DoxyCodeLine{183         \}}
\DoxyCodeLine{184 }
\DoxyCodeLine{185         T* release() \{}
\DoxyCodeLine{186                 T* tmp = \_ptr;}
\DoxyCodeLine{187                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{188                         \_ptr-\/>removeReferenceNoDelete();}
\DoxyCodeLine{189                 \_ptr = 0;}
\DoxyCodeLine{190                 \textcolor{keywordflow}{return} tmp;}
\DoxyCodeLine{191         \}}
\DoxyCodeLine{192 }
\DoxyCodeLine{193         \textcolor{keywordtype}{void} swap(\mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}}\& rp) \{}
\DoxyCodeLine{194                 T* tmp = \_ptr;}
\DoxyCodeLine{195                 \_ptr = rp.\_ptr;}
\DoxyCodeLine{196                 rp.\_ptr = tmp;}
\DoxyCodeLine{197         \}}
\DoxyCodeLine{198 }
\DoxyCodeLine{199 \textcolor{keyword}{private}:}
\DoxyCodeLine{200 }
\DoxyCodeLine{201         \textcolor{keyword}{template}<\textcolor{keyword}{class} Other> \textcolor{keywordtype}{void} assign(\textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr<Other>}}\& rp) \{}
\DoxyCodeLine{202                 \textcolor{keywordflow}{if} (\_ptr == rp.\_ptr)}
\DoxyCodeLine{203                         \textcolor{keywordflow}{return};}
\DoxyCodeLine{204                 T* tmp\_ptr = \_ptr;}
\DoxyCodeLine{205                 \_ptr = rp.\_ptr;}
\DoxyCodeLine{206                 \textcolor{keywordflow}{if} (\_ptr)}
\DoxyCodeLine{207                         \_ptr-\/>addReference();}
\DoxyCodeLine{208                 \textcolor{keywordflow}{if} (tmp\_ptr)}
\DoxyCodeLine{209                         tmp\_ptr-\/>removeReference();}
\DoxyCodeLine{210         \}}
\DoxyCodeLine{211 }
\DoxyCodeLine{212         \textcolor{keyword}{template}<\textcolor{keyword}{class} Other> \textcolor{keyword}{friend} \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr}};}
\DoxyCodeLine{213 }
\DoxyCodeLine{214         T* \_ptr;}
\DoxyCodeLine{215 \};}
\DoxyCodeLine{216 }
\DoxyCodeLine{217 \textcolor{keyword}{template}<\textcolor{keyword}{class} T> \textcolor{keyword}{inline}}
\DoxyCodeLine{218 \textcolor{keywordtype}{void} swap(\mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr<T>}}\& rp1, \mbox{\hyperlink{classcrpropa_1_1ref__ptr}{ref\_ptr<T>}}\& rp2) \{}
\DoxyCodeLine{219         rp1.swap(rp2);}
\DoxyCodeLine{220 \}}
\DoxyCodeLine{221 }
\DoxyCodeLine{222 \textcolor{keyword}{template}<\textcolor{keyword}{class} T> \textcolor{keyword}{inline} T* get\_pointer(\textcolor{keyword}{const} ref\_ptr<T>\& rp) \{}
\DoxyCodeLine{223         \textcolor{keywordflow}{return} rp.get();}
\DoxyCodeLine{224 \}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226 \textcolor{keyword}{template}<\textcolor{keyword}{class} T, \textcolor{keyword}{class} Y> \textcolor{keyword}{inline} ref\_ptr<T> static\_pointer\_cast(}
\DoxyCodeLine{227                 \textcolor{keyword}{const} ref\_ptr<Y>\& rp) \{}
\DoxyCodeLine{228         \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}T*\textcolor{keyword}{>}(rp.get());}
\DoxyCodeLine{229 \}}
\DoxyCodeLine{230 }
\DoxyCodeLine{231 \textcolor{keyword}{template}<\textcolor{keyword}{class} T, \textcolor{keyword}{class} Y> \textcolor{keyword}{inline} ref\_ptr<T> dynamic\_pointer\_cast(}
\DoxyCodeLine{232                 \textcolor{keyword}{const} ref\_ptr<Y>\& rp) \{}
\DoxyCodeLine{233         \textcolor{keywordflow}{return} \textcolor{keyword}{dynamic\_cast<}T*\textcolor{keyword}{>}(rp.get());}
\DoxyCodeLine{234 \}}
\DoxyCodeLine{235 }
\DoxyCodeLine{236 \textcolor{keyword}{template}<\textcolor{keyword}{class} T, \textcolor{keyword}{class} Y> \textcolor{keyword}{inline} ref\_ptr<T> const\_pointer\_cast(}
\DoxyCodeLine{237                 \textcolor{keyword}{const} ref\_ptr<Y>\& rp) \{}
\DoxyCodeLine{238         \textcolor{keywordflow}{return} \textcolor{keyword}{const\_cast<}T*\textcolor{keyword}{>}(rp.get());}
\DoxyCodeLine{239 \}}
\DoxyCodeLine{240 }
\DoxyCodeLine{242 \} \textcolor{comment}{// namespace crpropa}}
\DoxyCodeLine{243 }
\DoxyCodeLine{244 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// CRPROPA\_REFERENCED\_H}}

\end{DoxyCode}
