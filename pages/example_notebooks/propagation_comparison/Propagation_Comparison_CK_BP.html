<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comparison of Propagation Modules (BP - CK) &mdash; CRPropa3 3.2.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="canonical" href="https://crpropa.desy.de/pages/example_notebooks/propagation_comparison/Propagation_Comparison_CK_BP.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script src="../../../_static/js/breathe_fold.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Additional Resources" href="../../AdditionalResources.html" />
    <link rel="prev" title="Using CRPropa from C++" href="../../Cpp-projects.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/crpropa-logo_white.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Project Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Installation.html#download">Download</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Installation.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Installation.html#build-and-installation-variants">Build and Installation Variants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Installation.html#installation-in-system-path">Installation in system path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Installation.html#installation-in-python-virtualenv">Installation in python virtualenv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Installation.html#cmake-flags">CMake flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Installation.html#notes-for-specific-operating-systems">Notes for Specific Operating Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Installation.html#debian-ubuntu">Debian / Ubuntu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Installation.html#fedora-centos-rhel">Fedora/CentOS/RHEL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Installation.html#mac-os-x">Mac OS X</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Changelog.html#crpropa-vnext">CRPropa vNEXT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#bug-fixes">Bug fixes:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#new-features">New features:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#interface-changes">Interface changes:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#features-that-are-deprecated-and-will-be-removed-after-this-release">Features that are deprecated and will be removed after this release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#new-plugins-and-resources-linked-on-the-webpages">New plugins and resources linked on the webpages:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Changelog.html#crpropa-3-1-7">CRPropa 3.1.7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id1">Bug fixes:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id2">New features:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#interface-change">Interface change:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id3">Features that are deprecated and will be removed after this release:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Changelog.html#crpropa-v3-1-6">CRPropa v3.1.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id4">Bug fixes:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id5">New features:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Changelog.html#crpropa-v3-1-5">CRPropa v3.1.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id6">Bug fixes:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id7">New features:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id8">Features that are deprecated and will be removed after this release:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Changelog.html#id9">New plugins and resources linked on the webpages:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../FAQ.html#i-have-an-installation-issue">I have an installation issue…</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FAQ.html#how-to-specify-the-seed-for-the-random-number-generator">How to specify the seed for the random number generator?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FAQ.html#how-to-define-source-positions-from-a-matter-density-grid">How to define source positions from a matter density grid?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FAQ.html#how-to-use-version-tracking-of-a-python-steering-card">How to use version tracking of a python steering card?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FAQ.html#i-did-not-find-an-answer-to-my-question">I did not find an answer to my question…</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../howto_cite_crpropa.html">How to cite CRPropa</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../howto_cite_crpropa.html#core-components">Core Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../howto_cite_crpropa.html#external-models">External Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../howto_cite_crpropa.html#galactic-magnetic-field">Galactic Magnetic Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../howto_cite_crpropa.html#extragalactic-magnetic-field">Extragalactic Magnetic Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../howto_cite_crpropa.html#photon-backgrounds">Photon Backgrounds</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USAGE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Basic-concepts.html">Basic Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Basic-concepts.html#modular-design">Modular design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Basic-concepts.html#parallelization-multiprocessing">Parallelization/Multiprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Basic-concepts.html#unit-system">Unit system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Basic-concepts.html#particle-id">Particle ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Basic-concepts.html#reference-counting">Reference Counting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Simulation-Modules.html">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Simulation-Modules.html#propagation-modules">Propagation modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Simulation-Modules.html#interaction-modules">Interaction modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Simulation-Modules.html#conditional-modules">Conditional modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Simulation-Modules.html#observers">Observers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Simulation-Modules.html#output-modules">Output modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Simulation-Modules.html#other-modules">Other modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basics/basics.v4.html">Introduction to Python Steering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#Simulation-setup">Simulation setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#Propagating-a-single-particle">Propagating a single particle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#Defining-an-observer">Defining an observer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#Defining-the-output-file">Defining the output file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#Defining-the-source">Defining the source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#Running-the-simulation">Running the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/basics.v4.html#(Optional)-Plotting">(Optional) Plotting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extragalactic-simulations.html">Extragalactic Propagation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sim1D/sim1D.v4.html">1D simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sim1D/sim1D.v4.html#Simulation-Setup">Simulation Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sim1D/sim1D.v4.html#(Optional)-Plotting">(Optional) Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sim4D/sim4D.v4.html">4D Simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sim4D/sim4D.v4.html#Simulation-setup">Simulation setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sim4D/sim4D.v4.html#Periodic-boundaries">Periodic boundaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sim4D/sim4D.v4.html#Source-positions">Source positions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sim4D/sim4D.v4.html#Note:">Note:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../trajectories/trajectories.v4.html">3D trajectories in a turbulent field</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../trajectories/trajectories.v4.html#Saving-and-loading-fields">Saving and loading fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trajectories/trajectories.v4.html#Running-the-simulation">Running the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../trajectories/trajectories.v4.html#(Optional)-Plotting">(Optional) Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extragalactic_fields/MHD_models.v4.html">3D MHD models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../extragalactic_fields/MHD_models.v4.html#Supplied-data">Supplied data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extragalactic_fields/MHD_models.v4.html#Uniform-injection">Uniform injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extragalactic_fields/MHD_models.v4.html#Injection-following-density-field">Injection following density field</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extragalactic_fields/MHD_models.v4.html#Mass-Halo-injection">Mass Halo injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../extragalactic_fields/MHD_models.v4.html#Observer">Observer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../secondaries/photons.v4.html">Photon Propagation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../secondaries/photons.v4.html#(Optional)-plotting-of-the-results">(Optional) plotting of the results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../secondaries/photons.v4.html#Photon-Propagation-outside-of-CRPropa-with-EleCa-and-DINT">Photon Propagation outside of CRPropa with EleCa and DINT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../secondaries/photons.v4.html#Propagation-with-EleCa">Propagation with EleCa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../secondaries/photons.v4.html#Propagation-with-DINT">Propagation with DINT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../secondaries/photons.v4.html#Combined-Propagation">Combined Propagation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../secondaries/photons.v4.html#(Optional)-Plotting-of-Results">(Optional) Plotting of Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../secondaries/neutrinos.v4.html">Example with secondary neutrinos</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../secondaries/neutrinos.v4.html#Plotting-the-neutrino-energy-distribution">Plotting the neutrino energy distribution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../photon_propagation/cascade_1d.html">Electromagnetic cascade example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../photon_propagation/cascade_1d.html#Plotting">Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../targeting/Targeting.html">The targeting algorithm of CRPropa</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../targeting/Targeting.html#A-simple-example-on-how-to-use-the-targeting-algorithm-of-CRPropa">A simple example on how to use the targeting algorithm of CRPropa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../targeting/Targeting.html#Plotting-of-the-results">Plotting of the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../targeting/Targeting.html#A-learning-algorithm-to-obtain-optimal-values-for-mu-and-kappa">A learning algorithm to obtain optimal values for mu and kappa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../targeting/Targeting.html#Testing-sampling-results">Testing sampling results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../galactic_lensing.html">Propagation of Extragalactic CR in the Milky Way</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../galactic_backtracking/galactic_backtracking.v4.html">Galactic backtracking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../galactic_backtracking/galactic_backtracking.v4.html#Backtracking-a-single-cosmic-ray">Backtracking a single cosmic ray</a></li>
<li class="toctree-l3"><a class="reference internal" href="../galactic_backtracking/galactic_backtracking.v4.html#Backtracking-including-uncertainties">Backtracking including uncertainties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../galactic_backtracking/galactic_backtracking.v4.html#(Optional)-Plotting">(Optional) Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../galactic_backtracking/galactic_backtracking.v4.html#Backtracking-to-Generate-a-Lens">Backtracking to Generate a Lens</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../galactic_trajectories/galactic_trajectories.v4.html">Galactic trajectories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../galactic_trajectories/galactic_trajectories.v4.html#3D-trajectory-plot">3D trajectory plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../galactic_lensing/lensing_cr.v4.html">Galactic Lensing of Simulated Cosmic Rays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../galactic_lensing/lensing_cr.v4.html#Input-Results-from-Extragalactic-Simulation">Input Results from Extragalactic Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../galactic_lensing/lensing_cr.v4.html#Plot-Maps">Plot Maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../galactic_lensing/lensing_cr.v4.html#Apply-Galactic-Lenses">Apply Galactic Lenses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../galactic_lensing/lensing_cr.v4.html#Generate-Particles-from-Map">Generate Particles from Map</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../galactic_lensing/lensing_maps.v4.html">Galactic Lensing of Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../galactic_lensing/lensing_liouville.v4.html">Galactic Lensing - confirm Liouville</a></li>
<li class="toctree-l2"><a class="reference internal" href="../galactic_lensing/lensing_liouville.v4.html#Lambert’s-distribution">Lambert’s distribution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../galactic_cosmic_rays.html">Diffusion of Cosmic Rays</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Diffusion/DiffusionValidationI.v4.html">Diffusion Validation I</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationI.v4.html#This-notebook-simulates-a-diffusion-process-in-a-homogeneous-background-magnetic-field.-The-diffusion-tensor-is-anisotropic,-meaning-the-parallel-component-is-larger-than-the-perpendicular-component-(\kappa_\parallel-=-10\cdot\kappa_\perp).">This notebook simulates a diffusion process in a homogeneous background magnetic field. The diffusion tensor is anisotropic, meaning the parallel component is larger than the perpendicular component (<span class="math notranslate nohighlight">\(\kappa_\parallel = 10\cdot\kappa_\perp\)</span>).</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationI.v4.html#Distribution-in-x,-y-and-z">Distribution in x, y and z</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationI.v4.html#Use-the-absolute-distance-from-origin-|x|,-|y|,-|z|-and-compare-to-analytical-expectations.">Use the absolute distance from origin <span class="math notranslate nohighlight">\(|x|, |y|, |z|\)</span> and compare to analytical expectations.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationI.v4.html#Calculate-the-pValue-of-the-\chi^2-test-to-prove-the-visual-statement-from-above.">Calculate the pValue of the <span class="math notranslate nohighlight">\(\chi^2\)</span>-test to prove the visual statement from above.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Diffusion/DiffusionValidationII.v4.html">Diffusion Validation II</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationII.v4.html#This-notebbok-simulates-a-diffusion-process-in-a-homogenous-background-magnetic-field.-The-diffusion-tensor-is-anisotropic,-meaning-the-parallel-component-is-larger-than-the-perpendicular-component-(\kappa_\parallel-=-10\cdot\kappa_\perp).-Additionally,-a-wind-in-a-perpendicular-direction-is-included.">This notebbok simulates a diffusion process in a homogenous background magnetic field. The diffusion tensor is anisotropic, meaning the parallel component is larger than the perpendicular component (<span class="math notranslate nohighlight">\(\kappa_\parallel = 10\cdot\kappa_\perp\)</span>). Additionally, a wind in a perpendicular direction is included.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationII.v4.html#Anderson-Darling-Test">Anderson Darling Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/DiffusionValidationII.v4.html#Calculate-the-mean-and-variance">Calculate the mean and variance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../galactic_cosmic_rays.html#advection-and-adiabatic-energy-changes">Advection and Adiabatic Energy Changes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Diffusion/AdiabaticCooling.html">Adiabatic Cooling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Diffusion/AdiabaticCooling.html#Example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../galactic_cosmic_rays.html#gas-densities">Gas Densities</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../acceleration.html">Acceleration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../acceleration/second_order_fermi.html">Second Order Fermi Acceleration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../acceleration/first_order_fermi_acceleration.html">First Order Fermi Acceleration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extending_crpropa.html">Interfacing User Code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Extending-CRPropa.html">Implementing additional Modules and Features using Python only</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Extending-CRPropa.html#manual-simulation-processing">Manual Simulation Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Extending-CRPropa.html#plugins-integrate-custom-c-code-to-crpropa-s-python-steering">Plugins: Integrate Custom C++ Code to CRPropa’s Python Steering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/CustomObserver.v4.html">Custom Observer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Cpp-projects.html">Using CRPropa from C++</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Comparison of Propagation Modules (BP - CK)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Analytic-Solution">Analytic Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Helper-Functions">Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Run-Simulation">Run Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Load-Simulation-Data">Load Simulation Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Compare-the-Propagation-in-the-Perpendicular-Plane">Compare the Propagation in the Perpendicular Plane</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Compare-the-Propagation-in-the-Parallel-Direction">Compare the Propagation in the Parallel Direction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Conservation-of-Momentum">Conservation of Momentum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Comparison-with-3D-Analytic-Solution">Comparison with 3D Analytic Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Comparison-of-Simulation-Time">Comparison of Simulation Time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Turbulent-Magnetic-Field">Turbulent Magnetic Field</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Time-Comparison-for-Galactic-Trajectories">Time Comparison for Galactic Trajectories</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../AdditionalResources.html">Additional Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../building_blocks.html">Building Blocks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/CoreClasses.html">Core Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/PhysicsDefinitions.html">Physics Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/PropagationModules.html">Propagation Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/EnergyLosses.html">Energy Losses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/MagneticFields.html">Magnetic Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/Observers.html">Observer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/Condition.html">Condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/SourceFeatures.html">Source Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/Output.html">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/MagneticLens.html">Magnetic Lenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/Tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../buildingblocks/PhotonFields.html">Photon Fields</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/library_root.html">Library API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/library_root.html#class-hierarchy">Class Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/library_root.html#file-hierarchy">File Hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/library_root.html#full-api">Full API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#namespaces">Namespaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/namespace_crpropa.html">Namespace crpropa</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/namespace_eleca.html">Namespace eleca</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/namespace_Loki.html">Namespace Loki</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/namespace_std.html">Namespace std</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#classes-and-structs">Classes and Structs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/structcrpropa_1_1NuclearDecay_1_1DecayMode.html">Struct NuclearDecay::DecayMode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/structcrpropa_1_1Output_1_1Property.html">Struct Output::Property</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/structcrpropa_1_1PerformanceModule_1_1__module__info.html">Struct PerformanceModule::_module_info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/structcrpropa_1_1PhotoDisintegration_1_1Branch.html">Struct PhotoDisintegration::Branch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/structcrpropa_1_1PhotoDisintegration_1_1PhotonEmission.html">Struct PhotoDisintegration::PhotonEmission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/structcrpropa_1_1SophiaEventOutput.html">Struct SophiaEventOutput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1AbstractAccelerationModule.html">Class AbstractAccelerationModule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1AbstractCondition.html">Class AbstractCondition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1AdiabaticCooling.html">Class AdiabaticCooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1AdvectionField.html">Class AdvectionField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1AdvectionFieldList.html">Class AdvectionFieldList</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ArchimedeanSpiralField.html">Class ArchimedeanSpiralField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Base64.html">Class Base64</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1BlackbodyPhotonField.html">Class BlackbodyPhotonField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Candidate.html">Class Candidate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Clock.html">Class Clock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1CMB.html">Class CMB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1CMZField.html">Class CMZField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ConstantDensity.html">Class ConstantDensity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ConstantSphericalAdvectionField.html">Class ConstantSphericalAdvectionField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Cordes.html">Class Cordes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1CubicBoundary.html">Class CubicBoundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1CylindricalBoundary.html">Class CylindricalBoundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1CylindricalProjectionMap.html">Class CylindricalProjectionMap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Density.html">Class Density</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1DensityList.html">Class DensityList</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1DetectionLength.html">Class DetectionLength</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1DiffusionSDE.html">Class DiffusionSDE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1DirectedFlowOfScatterCenters.html">Class DirectedFlowOfScatterCenters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1DirectedFlowScattering.html">Class DirectedFlowScattering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ElasticScattering.html">Class ElasticScattering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ElectronPairProduction.html">Class ElectronPairProduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EllipsoidalBoundary.html">Class EllipsoidalBoundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EMCascade.html">Class EMCascade</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EMDoublePairProduction.html">Class EMDoublePairProduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EMInverseComptonScattering.html">Class EMInverseComptonScattering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EmissionMap.html">Class EmissionMap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EmissionMapFiller.html">Class EmissionMapFiller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EMPairProduction.html">Class EMPairProduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1EMTripletPairProduction.html">Class EMTripletPairProduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Ferriere.html">Class Ferriere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1FutureRedshift.html">Class FutureRedshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Grid.html">Template Class Grid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1GridProperties.html">Class GridProperties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Dominguez11.html">Class IRB_Dominguez11</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Finke10.html">Class IRB_Finke10</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Franceschini08.html">Class IRB_Franceschini08</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Gilmore12.html">Class IRB_Gilmore12</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Kneiske04.html">Class IRB_Kneiske04</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Stecker05.html">Class IRB_Stecker05</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Stecker16__lower.html">Class IRB_Stecker16_lower</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1IRB__Stecker16__upper.html">Class IRB_Stecker16_upper</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1JF12Field.html">Class JF12Field</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1JF12FieldSolenoidal.html">Class JF12FieldSolenoidal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1LensPart.html">Class LensPart</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1LogarithmicSpiralField.html">Class LogarithmicSpiralField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MagneticDipoleField.html">Class MagneticDipoleField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MagneticField.html">Class MagneticField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MagneticFieldEvolution.html">Class MagneticFieldEvolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MagneticFieldGrid.html">Class MagneticFieldGrid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MagneticFieldList.html">Class MagneticFieldList</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MagneticLens.html">Class MagneticLens</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MaximumTrajectoryLength.html">Class MaximumTrajectoryLength</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MinimumChargeNumber.html">Class MinimumChargeNumber</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MinimumEnergy.html">Class MinimumEnergy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MinimumEnergyPerParticleId.html">Class MinimumEnergyPerParticleId</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MinimumRedshift.html">Class MinimumRedshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1MinimumRigidity.html">Class MinimumRigidity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ModulatedMagneticFieldGrid.html">Class ModulatedMagneticFieldGrid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Module.html">Class Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ModuleList.html">Class ModuleList</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ModuleListRunner.html">Class ModuleListRunner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Nakanishi.html">Class Nakanishi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1NuclearDecay.html">Class NuclearDecay</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Observer.html">Class Observer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverDetectAll.html">Class ObserverDetectAll</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverElectronVeto.html">Class ObserverElectronVeto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverFeature.html">Class ObserverFeature</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverInactiveVeto.html">Class ObserverInactiveVeto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverLargeSphere.html">Class ObserverLargeSphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverNeutrinoVeto.html">Class ObserverNeutrinoVeto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverNucleusVeto.html">Class ObserverNucleusVeto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverParticleIdVeto.html">Class ObserverParticleIdVeto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverPhotonVeto.html">Class ObserverPhotonVeto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverPoint.html">Class ObserverPoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverRedshiftWindow.html">Class ObserverRedshiftWindow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverSmallSphere.html">Class ObserverSmallSphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverSurface.html">Class ObserverSurface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverTimeEvolution.html">Class ObserverTimeEvolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ObserverTracking.html">Class ObserverTracking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Output.html">Class Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ParaxialBox.html">Class ParaxialBox</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ParticleCollector.html">Class ParticleCollector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ParticleFilter.html">Class ParticleFilter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ParticleMapsContainer.html">Class ParticleMapsContainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ParticleSplitting.html">Class ParticleSplitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ParticleState.html">Class ParticleState</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PerformanceModule.html">Class PerformanceModule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PeriodicBox.html">Class PeriodicBox</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PeriodicMagneticField.html">Class PeriodicMagneticField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PhotoDisintegration.html">Class PhotoDisintegration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PhotonEleCa.html">Class PhotonEleCa</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PhotonField.html">Class PhotonField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PhotonOutput1D.html">Class PhotonOutput1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PhotoPionProduction.html">Class PhotoPionProduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Pixelization.html">Class Pixelization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PlanckJF12bField.html">Class PlanckJF12bField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Plane.html">Class Plane</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PlaneWaveTurbulence.html">Class PlaneWaveTurbulence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PolarizedSingleModeMagneticField.html">Class PolarizedSingleModeMagneticField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PropagationBP.html">Class PropagationBP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PropagationBP_1_1Y.html">Class PropagationBP::Y</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PropagationCK.html">Class PropagationCK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PropagationCK_1_1Y.html">Class PropagationCK::Y</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1PT11Field.html">Class PT11Field</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1QuasiLinearTheory.html">Class QuasiLinearTheory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Random.html">Class Random</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Redshift.html">Class Redshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ref__ptr.html">Template Class ref_ptr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Referenced.html">Class Referenced</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ReflectiveBox.html">Class ReflectiveBox</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1RestrictToRegion.html">Class RestrictToRegion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ScalarGrid.html">Class ScalarGrid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SecondOrderFermi.html">Class SecondOrderFermi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ShellOutput.html">Class ShellOutput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ShellOutput1D.html">Class ShellOutput1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1ShellPropertyOutput.html">Class ShellPropertyOutput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SimplePropagation.html">Class SimplePropagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Source.html">Class Source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceComposition.html">Class SourceComposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceDensityGrid.html">Class SourceDensityGrid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceDensityGrid1D.html">Class SourceDensityGrid1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceDirectedEmission.html">Class SourceDirectedEmission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceDirection.html">Class SourceDirection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceEmissionCone.html">Class SourceEmissionCone</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceEmissionMap.html">Class SourceEmissionMap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceEnergy.html">Class SourceEnergy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceFeature.html">Class SourceFeature</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceInterface.html">Class SourceInterface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceIsotropicEmission.html">Class SourceIsotropicEmission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceLambertDistributionOnSphere.html">Class SourceLambertDistributionOnSphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceList.html">Class SourceList</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceMultipleParticleTypes.html">Class SourceMultipleParticleTypes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceMultiplePositions.html">Class SourceMultiplePositions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceParticleType.html">Class SourceParticleType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourcePosition.html">Class SourcePosition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourcePowerLawSpectrum.html">Class SourcePowerLawSpectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourcePulsarDistribution.html">Class SourcePulsarDistribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceRedshift.html">Class SourceRedshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceRedshift1D.html">Class SourceRedshift1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceRedshiftEvolution.html">Class SourceRedshiftEvolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceSNRDistribution.html">Class SourceSNRDistribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniform1D.html">Class SourceUniform1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniformBox.html">Class SourceUniformBox</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniformCylinder.html">Class SourceUniformCylinder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniformHollowSphere.html">Class SourceUniformHollowSphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniformRedshift.html">Class SourceUniformRedshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniformShell.html">Class SourceUniformShell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SourceUniformSphere.html">Class SourceUniformSphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Sphere.html">Class Sphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SphericalAdvectionField.html">Class SphericalAdvectionField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SphericalAdvectionShock.html">Class SphericalAdvectionShock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SphericalBoundary.html">Class SphericalBoundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1StepLengthModifier.html">Class StepLengthModifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Surface.html">Class Surface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1SynchrotronRadiation.html">Class SynchrotronRadiation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1TabularPhotonField.html">Class TabularPhotonField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1TextOutput.html">Class TextOutput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1TF17Field.html">Class TF17Field</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1TorroidalHaloField.html">Class TorroidalHaloField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1TurbulenceSpectrum.html">Class TurbulenceSpectrum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1TurbulentField.html">Class TurbulentField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1UniformAdvectionField.html">Class UniformAdvectionField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1UniformMagneticField.html">Class UniformMagneticField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1URB__Fixsen11.html">Class URB_Fixsen11</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1URB__Nitu21.html">Class URB_Nitu21</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1URB__Protheroe96.html">Class URB_Protheroe96</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Variant.html">Class Variant</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Variant_1_1bad__conversion.html">Class Variant::bad_conversion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1Vector3.html">Template Class Vector3</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classcrpropa_1_1VectorGrid.html">Class VectorGrid</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/classURB.html">Class URB</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#enums">Enums</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/enum_namespacecrpropa_1a025791393b56feb9a61c13b1d7eeafd5.html">Enum DetectionState</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/enum_namespacecrpropa_1aa197adf50cede38157e51842d7a713f8.html">Enum interpolationType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/enum_namespacecrpropa_1af7513ac77cc27dbf612a5e0690c82c4c.html">Enum TF17DiskModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/enum_namespacecrpropa_1aafad8b2c308adeb57af2612eed384fb5.html">Enum TF17HaloModel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga0c658ca545d45436c718148e9b82af87.html">Function crpropa::chargeNumber</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gaea966817d7679bb00bd12e22135184fc.html">Template Function crpropa::clip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gaecc325fd115bd796f3c0e77cb689ebae.html">Function crpropa::closestIndex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga99330b59d91d6c538122bc1e477e24c4.html">Function crpropa::comoving2LightTravelDistance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga512961b323c6706458df15e5c11f09fb.html">Function crpropa::comovingDistance2Redshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga0663b76fe38fa53188a902e8f70bbb8c.html">Template Function crpropa::const_pointer_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga03f1b5d08b70e6a06ed71d9006dea6de.html">Function crpropa::convertIdToName</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a29dbf1e61010b4104941a96eaa846cf1.html">Function crpropa::deserialize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga0f0f1fbfd43cc9a796d65bf1beeaa6e2.html">Function crpropa::digit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a7ea72826e167beaa042efafaec6876da.html">Function crpropa::DintElecaPropagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1aa45964706e7d6ba2ffac41794424769f.html">Function crpropa::DintPropagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gad5b5ba4c8f79b6b797c57d7ee658c1a6.html">Function crpropa::dumpGrid(ref_ptr&lt;Grid3f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga2be301c04cc62be7b1efdc3d8472dcda.html">Function crpropa::dumpGrid(ref_ptr&lt;Grid1f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gad230c08955c7a505eefe413366f4717a.html">Function crpropa::dumpGridToTxt(ref_ptr&lt;Grid3f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga25cabf4d5be84ea94f9bd90d50b17a13.html">Function crpropa::dumpGridToTxt(ref_ptr&lt;Grid1f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga44546dc98a4f8e8bd50afae4ae1fec8b.html">Template Function crpropa::dynamic_pointer_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1aca0899b6299bda24481d6ec1eeff7988.html">Function crpropa::ElecaPropagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gaf89e81d370fe811cc9386261f02166a5.html">Function crpropa::fromMagneticField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga0501e5b31dd2cdb5159459d874f16d30.html">Function crpropa::fromMagneticFieldStrength</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a7b2c3263f63a99e6ed493fb1848a8ff1.html">Template Function crpropa::gaussInt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga1bb6f6a9de2fdd3f1fd8e1f36a03d1b6.html">Template Function crpropa::get_pointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga1df13d495273a79e3350f157af7b4ea3.html">Function crpropa::getDataPath</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gafaaaa2733a31f763ffd1fa28bfab81ca.html">Function crpropa::getInstallPrefix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga6fccfc5a896dc6f1036d2abbfca4ae2a.html">Function crpropa::H0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1gaca47de327745e542b987dc0fdc0544ad.html">Function crpropa::hubbleRate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga3ea9c7bef53d02cb7a867c72182768b7.html">Function crpropa::interpolate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gab28d821e32f177c9c1d1e3658796f259.html">Function crpropa::interpolate2d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga45ce85dc4b25887b2c527719c7531b4e.html">Function crpropa::interpolateEquidistant</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga6807b028241faff59152dde29e2edfb9.html">Function crpropa::intrusive_ptr_add_ref</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gadd64a0c21dcedde2102f949e36f2f1d3.html">Function crpropa::intrusive_ptr_release</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga7a02cec5006af6f5eb4bd415ea9ab2db.html">Function crpropa::isNucleus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga1cad0b62bf8c1b8b1dd44295b3ec40f9.html">Function crpropa::lightTravel2ComovingDistance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga203d7d59dabadfa6e77a05263f77c819.html">Function crpropa::lightTravelDistance2Redshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gab7c740cf66f560083029b8a6196a46a4.html">Function crpropa::loadGrid(ref_ptr&lt;Grid3f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga091a17cca41dba2b79ec383f7f9e8f37.html">Function crpropa::loadGrid(ref_ptr&lt;Grid1f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gaad9520b837fa3ff060ed1786da8c7f52.html">Function crpropa::loadGridFromTxt(ref_ptr&lt;Grid3f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gab66dd49f6fc38ee6834eff297e730ae3.html">Function crpropa::loadGridFromTxt(ref_ptr&lt;Grid1f&gt;, std::string, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1gafe272632098a27755f88a8503e04481f.html">Function crpropa::luminosityDistance2Redshift</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1gaf2b051d255cfeb00149e80831e0c3b5d.html">Function crpropa::massNumber</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a2f6ed50a4dd5e68e6532340866a6819d.html">Function crpropa::maximumOfSumsOfColumns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga35a4fc74b7deadd58ff6209df14140c0.html">Function crpropa::meanFieldStrength(ref_ptr&lt;Grid1f&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga095a3cc70d79ca2a58df236d823fc7f2.html">Function crpropa::meanFieldStrength(ref_ptr&lt;Grid3f&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga14e9170907096634f33d71ec5aae75d3.html">Function crpropa::meanFieldVector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a855096c8ab3bc4b926e81bd45d2ed743.html">Function crpropa::norm_1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a02a34444430a990a7a1cec430148f345.html">Function crpropa::normalizeColumns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1ad8d07016ad6bfeeb3820f0e6a28c4f77.html">Function crpropa::normalizeMatrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga2f8daaf6e06efae63d7c323230458937.html">Function crpropa::nuclearMass(int)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga6a21da6982c810db1b77794e8b9ef179.html">Function crpropa::nuclearMass(int, int)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga4cfe916fc8af0f4a394ad6e541a1e834.html">Function crpropa::nucleusId</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga73ed5eab2ffc8064c0cb8f169d568a07.html">Function crpropa::omegaL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1gac97a929f7aaea9e4a346e319167d05fa.html">Function crpropa::omegaM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga23bf6b37f4133adc37b6f3d057410c94.html">Template Function crpropa::operator*</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a0a3faf0d97b1add4a0fc947c3498415d.html">Function crpropa::operator&lt;&lt;(std::ostream&amp;, const Variant&amp;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gaf1695869279c2571e31c8547f65fe9c5.html">Template Function crpropa::operator&lt;&lt;(std::ostream&amp;, const Vector3&lt;T&gt;&amp;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga688c4960d76366bf6fce1cf5eac2f129.html">Template Function crpropa::operator&gt;&gt;</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1ae8add7f940570a0e49a13093314654aa.html">Function crpropa::periodicBoundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a40c64acf5922cfe05f6b5a82d008b201.html">Function crpropa::periodicClamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a84149e2a416af8480e9d992cbd1eed95.html">Template Function crpropa::pow_integer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1af4fe3bfea48d26d7e167c0129dc277cf.html">Function crpropa::pow_integer&lt; 0 &gt;</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a311fac498c76c37962a69f010f41dc43.html">Function crpropa::prod_up</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga74be55ec3e23caff21310b51b53cab35.html">Function crpropa::redshift2ComovingDistance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga682405d9081864aaa0b706ede0736244.html">Function crpropa::redshift2LightTravelDistance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1ga21044b6b8dc8baa6bc0d62296b5be92c.html">Function crpropa::redshift2LuminosityDistance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1a42f2bb65aca43e8defb9d7a922814c7f.html">Function crpropa::reflectiveBoundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1ace22026777085984c6892b1fe629ec13.html">Function crpropa::reflectiveClamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga788ff1002bda23d428e0e43ac5b7cf3a.html">Function crpropa::rmsFieldStrength(ref_ptr&lt;Grid1f&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga42f4cdca40b5d3f1632ac93a886a8781.html">Function crpropa::rmsFieldStrength(ref_ptr&lt;Grid3f&gt;)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gad823c8cf8555f1b45432468adef2d404.html">Function crpropa::rmsFieldStrengthPerAxis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1afdfae60dd4680363c4a98a60d4b087b6.html">Function crpropa::round</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga0d66e0a4632d21364c4227784074f53e.html">Function crpropa::scaleGrid(ref_ptr&lt;Grid1f&gt;, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gad86fe3acb119896b39adb6d751b57700.html">Function crpropa::scaleGrid(ref_ptr&lt;Grid3f&gt;, double)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_namespacecrpropa_1aa9174909a4e0ee185d124caabf1549a0.html">Function crpropa::serialize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__PhysicsDefinitions_1gaf26fcc97f8c2cd7b6613950265dbd473.html">Function crpropa::setCosmologyParameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1ga21ca69db76e5efe007489b30d0d92ef8.html">Template Function crpropa::static_pointer_cast</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_group__Core_1gaef75b9b7ae9d4b5d5258b8674259d715.html">Template Function crpropa::swap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Version_8h_1ae07054153f2b6877a8acf6fbf1ee7090.html">Function declare_version</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Logging_8h_1ab43ea5e6a41057a2928f96ec406f2a4b.html">Function logDebug</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Logging_8h_1aad224c61f361c9b29018dbe5814a2a22.html">Function logError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Logging_8h_1ac23a678ce7417b5e66fcfdd567638c2e.html">Function logInfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Logging_8h_1a5cca4960115ee6d2ef11596a7d0a62fb.html">Function logWarning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_AssocVector_8h_1a4bd2d26e2a4b894ca7611ac096434c21.html">Template Function Loki::operator!=</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_AssocVector_8h_1ae784f4505d4e82cdca799b4e4d9db886.html">Template Function Loki::operator&lt;=</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_AssocVector_8h_1a935c3734691858d4ab91e7c8ac92a756.html">Template Function Loki::operator==</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_AssocVector_8h_1acc91f1a4d6b2684be1ae9cc97b36636e.html">Template Function Loki::operator&gt;</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_AssocVector_8h_1a3678dd23d67866599ad3c43ecee2ff34.html">Template Function Loki::operator&gt;=</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_AssocVector_8h_1adbe957affd452026980681c7bd18f950.html">Template Function Loki::swap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Logging_8h_1a0be980c8c7fb754367a4346ac48cbf7f.html">Function setLogLevel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/function_Logging_8h_1af4cf0ce9be6440b42774830da5c24fba.html">Function setLogStream</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#variables">Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__MagneticLenses_1gae5e279b73f61763edc7d0651e38e481d.html">Variable crpropa::_nOrder_max</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__MagneticLenses_1ga3e6fb5fa38bb69d9a6852cf2e0d97437.html">Variable crpropa::_nPix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaa772c1c559fd8275f62df4628594c14c.html">Variable crpropa::ampere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga0595e59a9bf296545e5ab563066df679.html">Variable crpropa::amu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga5014cfb8c7422235fb7a8e549e29284d.html">Variable crpropa::atto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gae57f427be881e4c8f1163470da1befb2.html">Variable crpropa::au</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga8d9a59356bad97a6e73cc459a35bc274.html">Variable crpropa::barn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga2085cc4cdb90e7a156b5dbdbe44bf7aa.html">Variable crpropa::c_light</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga35d305b22a8de1cab9f18bf3e0fe48ba.html">Variable crpropa::c_squared</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga9c4fc0db13341889d27441fd36da13c5.html">Variable crpropa::ccm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga8b99ed3101c591c1133f492d94fa3685.html">Variable crpropa::centimeter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gad0b9a58075a15c1cb674a2b879402853.html">Variable crpropa::cm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga9f729835f8d7ddb8ab71fce2108d7566.html">Variable crpropa::coulomb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga2f5042227e4fdba943844e169f5cf010.html">Variable crpropa::deg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab1e9216cf93077db4901e1820dffa132.html">Variable crpropa::EeV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga384bc54c9a15fa0d84ae78416653c9c4.html">Variable crpropa::electronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga53b77492aea234537215b9ba7177882c.html">Variable crpropa::eplus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab38b15c5eece78fad9d84103d8b90a89.html">Variable crpropa::epsilon0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga8d678b199c22b3f6719333b6ed3b3e39.html">Variable crpropa::erg</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga87b385f118e3715860117a77eda7136d.html">Variable crpropa::eV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga7f1280863986e5f4b59fae29afbecabc.html">Variable crpropa::exa</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga4aa592dff0d55ae915648a03dfe46dd1.html">Variable crpropa::exaelectronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gabea2135256ac31f26ed041ab577f8c13.html">Variable crpropa::femto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gad7c4f80eaae50061ac4b754cbb5f0275.html">Variable crpropa::gauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaec0e126d9991db8ad0b26139f5860568.html">Variable crpropa::GeV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaf2299d510cc08e636439584682a88303.html">Variable crpropa::giga</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga67f77928286c0c47c56fb64ef6445517.html">Variable crpropa::gigaelectronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaf8524dd93cb2df63eabbbd443e5014ff.html">Variable crpropa::gigaparsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaaf33764feb34669b8ffe006cc943067d.html">Variable crpropa::Gpc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga5625ec9f520a5f041fb88f5da5f94bef.html">Variable crpropa::h_planck</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga1f940bb86795ed45e1417ad32321a551.html">Variable crpropa::hertz</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga09c047eba91ce1d85e4e7fdd4bafebe4.html">Variable crpropa::hour</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaca2a407ebab577eb092585f84631c8d0.html">Variable crpropa::joule</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga12088648de7f88c5accd233032d3153e.html">Variable crpropa::k_boltzmann</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gad6635fb9b9ed7cc9fee15071b9432091.html">Variable crpropa::kelvin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga71187dfc8f158326cbf7bed526138aae.html">Variable crpropa::keV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga05ccc8bd868280980dab40ca4128d8e4.html">Variable crpropa::kilo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga2e4f006f78ed12d318baa9ef08a9e799.html">Variable crpropa::kiloelectronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga8955be82c3d643afe27de76d06df52e8.html">Variable crpropa::kilogram</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga6183103d0e243ef4347cd071cc5fd68b.html">Variable crpropa::kilometer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga0470d2bb7af674e93def309564e0d51a.html">Variable crpropa::kiloparsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaaf85ed8b741937db702f62aac693ae5d.html">Variable crpropa::km</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga1ec6fd9219412d45c0565c29304d5184.html">Variable crpropa::kpc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaaa1e0123e1baad493ec687904a428cbf.html">Variable crpropa::ly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga21aa8093ee2f43ed4e85b31b64304c7a.html">Variable crpropa::mass_electron</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga1d1f8f060a1f4657bafdd7065b01d943.html">Variable crpropa::mass_neutron</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaf5068a3fc840800f912a14e09c4777ff.html">Variable crpropa::mass_proton</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga8912b14f7b302e534e7eb063288f6ee9.html">Variable crpropa::mega</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga4f2c7d727d45a6c6a39e648c48a68bf4.html">Variable crpropa::megaelectronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gac3da9c52caabd55b3d229735cc925e5e.html">Variable crpropa::megaparsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga81230fc213736db75d5c970e68886a10.html">Variable crpropa::meter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gac90e720c4654493ae50b7b964cc6b20d.html">Variable crpropa::MeV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga9edb08003fe77ed3bacd9ea23bcfa66b.html">Variable crpropa::micro</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab70342abf0832b9dd265964c21681319.html">Variable crpropa::microgauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga33252a2d991e1b089ea0c7540ef334ea.html">Variable crpropa::microsecond</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga795961ce904cb279d5fd18b27622c9a0.html">Variable crpropa::milli</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gae32c5b1394299598268f59e850e70d91.html">Variable crpropa::millisecond</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga583f186218b8bf2ad5c54928a6c20134.html">Variable crpropa::minute</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaabefcc198b3e2606497fd55b370846fa.html">Variable crpropa::mol</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga03be4183d6f731898634e3649865848c.html">Variable crpropa::Mpc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga40448747ca0606885ccc70b72ed78001.html">Variable crpropa::ms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaa2940cb38b48f36a88341bd268778847.html">Variable crpropa::mu0</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga5596cdaf7a42ba58794c2c6dc5e1e7dd.html">Variable crpropa::muG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga38012ba2795f7181e87ea3a4a0b0e32f.html">Variable crpropa::mus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gac6aa1e9406f8b758f5e41d80e0045733.html">Variable crpropa::nano</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab676ddbbf379cc0ee93944717e1ac9eb.html">Variable crpropa::nanogauss</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab1ad77ec7ae37ba36c2c7f8785440281.html">Variable crpropa::nanosecond</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga86cabed6b39944d7bada06028f98c864.html">Variable crpropa::newton</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab2255fb9f970de1ddc40b38fe9065de4.html">Variable crpropa::nG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gae9508134491d8a9621d23f07281096c7.html">Variable crpropa::ns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gadbbb3073e1b8a1b9fd72a488dc7abefa.html">Variable crpropa::parsec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaab6215c4cb38b8fcb808d8ff11e0940c.html">Variable crpropa::pascal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga2884cd030c4c825754349a525a1d06ce.html">Variable crpropa::pc</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gab4e48de47138d9b3db5a04e1a3d6be1d.html">Variable crpropa::peta</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaea037b37e9acec1a6e766802f3ebd7fb.html">Variable crpropa::petaelectronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga463540ec70967dcc4e597ef8adc7f44c.html">Variable crpropa::PeV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gac6aff7a2b743abc2a58df8e7b34470d8.html">Variable crpropa::pico</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga509c941bf1649360f649fda481fa10f0.html">Variable crpropa::rad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga775a3e65279359fb2b464f0aedc383f1.html">Variable crpropa::sec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga4e6001382c137dd906faab8f49a0a219.html">Variable crpropa::second</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga601bd967274470accc5c479bf1a991ce.html">Variable crpropa::tera</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga6591214065a17f6977e05807be74db81.html">Variable crpropa::teraelectronvolt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga2ec29f0d0bb0bdf93d5e4d1663eebd9a.html">Variable crpropa::tesla</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga7f801e1f6821bc6baf0652ed2496e5e9.html">Variable crpropa::TeV</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga90ad310c0986c21c31d3695d97922db7.html">Variable crpropa::volt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_namespacecrpropa_1a43779031bbc6e102be279b8702c5eef5.html">Variable crpropa::W</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_namespacecrpropa_1ae0e636b5119e31607138675be292cf2c.html">Variable crpropa::X</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gad9f87532fe6bac146c75ef173bd468d8.html">Variable crpropa::yocto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1ga85979a8ef8dbc332c635191cd40a3b0c.html">Variable crpropa::yotta</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gaecd7702608529a1c8d8c744542b64bd4.html">Variable crpropa::zepto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_group__PhysicsDefinitions_1gad92d24cec8d208c82569e29279becc10.html">Variable crpropa::zetta</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_Version_8h_1a6834134ebcf1a7fadc2562fc74544f46.html">Variable g_GIT_DESC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_Version_8h_1a36b71113647c58eb81b6f6faf06f784b.html">Variable g_GIT_REFSPEC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/variable_Version_8h_1a6e70968528819ece37e7d5f722c53efc.html">Variable g_GIT_SHA1</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#defines">Defines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/define_Random_8h_1ae71449b1cc6e6250b91f539153a7a0d3.html">Define M_PI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/define_Variant_8h_1ad6e6dfd43bfb6550b7f310b003ea5e86.html">Define VARIANT_ADD_TYPE_DECL_POD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/define_Variant_8h_1aff699997fd1e4e13671e56d58c3ecef3.html">Define VARIANT_ADD_TYPE_DECL_PTR</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/define_Variant_8h_1a71711a376be30763557289e90e82547c.html">Define VARIANT_ADD_TYPE_DECL_PTR_BASE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/define_Variant_8h_1acdf3895ba788152a9cc113b7fd1e643c.html">Define VARIANT_TO_DECL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/library_root.html#typedefs">Typedefs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_namespacecrpropa_1ad47ce08e957c3542cd0715bc2e933293.html">Typedef crpropa::const_LensPartIter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_group__Core_1gad761d09abe25f824acac027b04dd1507.html">Typedef crpropa::Grid1d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_group__Core_1ga618737687b6e91f66fe1f4da1134e925.html">Typedef crpropa::Grid1f</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_group__Core_1gace03eaf2fd573de2d84e3aebf60fd729.html">Typedef crpropa::Grid3d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_group__Core_1gaa4f8aec71606a16ed58c4f16efaabb23.html">Typedef crpropa::Grid3f</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_namespacecrpropa_1af135df255ba94df054e3289a0526f3b3.html">Typedef crpropa::LensPartIter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_namespacecrpropa_1afdeae388527922b41dd13abc77ffdb59.html">Typedef crpropa::ModelMatrixType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_namespacecrpropa_1a38b820ffe798c468ff6cf1b15efad830.html">Typedef crpropa::ModelVectorType</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_group__Core_1ga1f05093f5ee1a9ecdd54476792e4c206.html">Typedef crpropa::Vector3d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/typedef_group__Core_1gaf345ad77ba5e240c7ab72b4b2077e754.html">Typedef crpropa::Vector3f</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DEVEL</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Debugging.html">GNU Debugger (GDB)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Debugging.html#profiling">Profiling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Debugging.html#simple-example">Simple example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Debugging.html#profile-crpropa">Profile CRPropa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Debugging.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Code-Coverage.html">Code Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Data-files.html">Verify the Data Files Integrity</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CRPropa3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Comparison of Propagation Modules (BP - CK)</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Comparison-of-Propagation-Modules-(BP---CK)">
<h1>Comparison of Propagation Modules (BP - CK)<a class="headerlink" href="#Comparison-of-Propagation-Modules-(BP---CK)" title="Permalink to this headline"></a></h1>
<p>Numerical simulations of the propagation of charged particles through magnetic fields, solving the equation of motion can be achieved in principle with many different algorithms. There are, however, an increasing number of studies that have found that there are two algorithms, which work in general best for propagating charged particles within a magnetic field [1,2,3]. These two algorithms are compared and evaluated.</p>
<p>Both the Boris push [4] and the Cash-Karp [3] algorithms solve the Lorentz equation and thus enable the propagation of charged particles through magnetic fields. For the simplest case of a homogeneous background field, the particle trajectory can be derived analytically. This enables comparison with numerical integrators and provides information on the errors of the algorithms for the corresponding parameters being used. The aim is to find a relationship between the error and the parameters
applied. The pitch angle and the step length are suitable parameters to determine the influence.</p>
<p>Consequently, we want to understand which algorithm is suitable for each simulation setup.</p>
<section id="Analytic-Solution">
<h2>Analytic Solution<a class="headerlink" href="#Analytic-Solution" title="Permalink to this headline"></a></h2>
<p>The trajectory of a charged particle in a homogeneous background field can be solved analytically. We assume that the particle starts off with non-zero component of the momentum (<span class="math notranslate nohighlight">\(p_z &gt; 0\)</span>) along the background magnetic field. The particle, then moves in a helix whose gyration radius is given by: <span class="math notranslate nohighlight">\(r_g = \frac{E}{B\cdot q \cdot c}\)</span></p>
<p>The velocity component parallel to the background field remains constant. The analytical solution for the <em>direction = Vector3d(p_x, p_y, p_z)</em> with <span class="math notranslate nohighlight">\(p_x^2+p_y^2+p_z^2 = 1\)</span> and the <em>position = Vector3d(0, 0, 0)</em> yields:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">analytical_solution</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_steps</span><span class="p">):</span>
    <span class="c1"># calculate the time stamps similar to that used in the numerical simulation</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_trajectory</span><span class="o">/</span><span class="n">pc</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_steps</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># shift the phase so that the analytical solution</span>
    <span class="c1"># also starts at (0,0,0) with in the direction (p_x,p_y,p_z)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="n">r_g_0</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span>

    <span class="c1"># for parallel motion corrected gyro radius</span>
    <span class="n">r_g</span> <span class="o">=</span> <span class="n">r_g_0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># at these trajectory lengths, the numerical solutions are known</span>
    <span class="n">x_ana</span> <span class="o">=</span> <span class="n">r_g</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">y_ana</span> <span class="o">=</span> <span class="o">-</span><span class="n">r_g</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">z_ana</span> <span class="o">=</span> <span class="n">p_z</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span>
</pre></div>
</div>
</div>
</section>
<section id="Helper-Functions">
<h2>Helper Functions<a class="headerlink" href="#Helper-Functions" title="Permalink to this headline"></a></h2>
<p>We define functions with which we can calculate the gyration radius and the circumference. In addition we only want to define how many steps we require per circumference and how many gyrations should be performed. The last helping function should then calculate the maximum trajectory length and the step size, so that our requirements are fulfilled.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">crpropa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Gyro radius should be R_g = 10.810076 parsecs for p_z = 0 and B = 10nG and E = 100 TeV</span>
<span class="k">def</span> <span class="nf">larmor_radius</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">getMomentum</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getRegularField</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">getPosition</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getField</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">getPosition</span><span class="p">())</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">getCharge</span><span class="p">()</span>
        <span class="n">p_perp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getPerpendicularTo</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">p_perp</span><span class="o">.</span><span class="n">getR</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">getR</span><span class="p">()</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">1000000</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="c1"># Calculate gyro radius</span>
<span class="k">def</span> <span class="nf">larmor_circumference</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
    <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">larmor_radius</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">/</span><span class="n">pc</span> <span class="c1"># gyro radius for p_z = 0</span>
    <span class="n">l_gyration</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">r_g_0</span><span class="o">*</span><span class="n">pc</span>    <span class="c1"># trajectory lenght of one gyration</span>
    <span class="k">return</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">l_gyration</span>

<span class="c1"># Trajectory length of particle in number of gyrations</span>
<span class="k">def</span> <span class="nf">maximum_trajectory</span><span class="p">(</span><span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_of_gyrations</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">p_z</span><span class="p">):</span>
    <span class="n">r_g_0</span><span class="p">,</span> <span class="n">l_gyration</span> <span class="o">=</span> <span class="n">larmor_circumference</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
    <span class="n">max_trajectory</span> <span class="o">=</span> <span class="n">l_gyration</span><span class="o">*</span><span class="n">number_of_gyrations</span>
    <span class="n">steplength</span> <span class="o">=</span> <span class="n">l_gyration</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">steps_per_gyrations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_trajectory</span><span class="p">,</span> <span class="n">steplength</span><span class="p">,</span> <span class="n">r_g_0</span>
</pre></div>
</div>
</div>
</section>
<section id="Run-Simulation">
<h2>Run Simulation<a class="headerlink" href="#Run-Simulation" title="Permalink to this headline"></a></h2>
<p>We can now compare the analytical solution with both particle integrators in CRPropa, namely the Boris push and the Cash-Karp.</p>
<p>First we have to add our propagation module with the above specialized background magnetic field to our module list. Afterwards we can specify that the particle information is collected at each step along the particle trajectory. With the output module, we can specify where these information will be saved.</p>
<p>Now that we have our module list ready we can fire up our simulation with both propagation algorithms and hope that something visually interesting is going to happen.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">Time</span>

<span class="c1"># We use only a Background magnetic field in the z-direction.</span>
<span class="c1"># We could add more complex magentic fields to our MagneticFieldList.</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">nG</span>
<span class="n">direction_B</span> <span class="o">=</span> <span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">const_mag_vec</span> <span class="o">=</span> <span class="n">direction_B</span> <span class="o">*</span> <span class="n">B</span>
<span class="n">reg_field</span> <span class="o">=</span> <span class="n">UniformMagneticField</span><span class="p">(</span><span class="n">const_mag_vec</span><span class="p">)</span>


<span class="c1">### Running the simulation with either CK or BP</span>
<span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_of_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">):</span>
    <span class="c1"># Initial condition of candidate</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">p_y</span> <span class="o">=</span> <span class="n">p_x</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">TeV</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="n">Vector3d</span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">p_y</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">Candidate</span><span class="p">(</span><span class="n">nucleusId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">E</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>

    <span class="n">max_trajectory</span><span class="p">,</span> <span class="n">steplength</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">maximum_trajectory</span><span class="p">(</span><span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_of_gyrations</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">reg_field</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>

    <span class="n">sim</span> <span class="o">=</span> <span class="n">ModuleList</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;CK&#39;</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationCK</span><span class="p">(</span><span class="n">reg_field</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">,</span><span class="n">steplength</span><span class="p">,</span> <span class="n">steplength</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">TextOutput</span><span class="p">(</span><span class="s1">&#39;trajectory_CK.txt&#39;</span><span class="p">,</span> <span class="n">Output</span><span class="o">.</span><span class="n">Trajectory3D</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationBP</span><span class="p">(</span><span class="n">reg_field</span><span class="p">,</span> <span class="n">steplength</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">TextOutput</span><span class="p">(</span><span class="s1">&#39;trajectory_BP.txt&#39;</span><span class="p">,</span> <span class="n">Output</span><span class="o">.</span><span class="n">Trajectory3D</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no module found. Use either BP or CK.&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># we only want to simulate a certain trajectory length</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaximumTrajectoryLength</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">))</span>
    <span class="c1"># the output information will be saved in pc instead of the default which is Mpc</span>
    <span class="n">output</span><span class="o">.</span><span class="n">setLengthScale</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
    <span class="c1"># each particle position will be saved in the above specified text field.</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="c1"># compare the simulation time of both propagation methods</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c1"># run the simulation</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation time with module &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;s.&#39;</span><span class="p">)</span>
    <span class="n">Time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span>
</pre></div>
</div>
</div>
</section>
<section id="Load-Simulation-Data">
<h2>Load Simulation Data<a class="headerlink" href="#Load-Simulation-Data" title="Permalink to this headline"></a></h2>
<p>There are several ways to load the simulation data. Pandas is helpful to load files. To illustrate this, we will load and process the data with pandas.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">r_g</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>
                 <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;Px&#39;</span><span class="p">,</span><span class="s1">&#39;Py&#39;</span><span class="p">,</span><span class="s1">&#39;Pz&#39;</span><span class="p">],</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                 <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span><span class="s2">&quot;Px&quot;</span><span class="p">,</span><span class="s2">&quot;Py&quot;</span><span class="p">,</span><span class="s2">&quot;Pz&quot;</span><span class="p">])</span>

    <span class="c1">### distances are saved in units of pc</span>
    <span class="c1">### transform so that the center of the gyromotion is at (0,0)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="n">r_g</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">data</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">r_g</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="c1">### convert disctance in kpc</span>
    <span class="n">data</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="mf">1000.</span>

    <span class="c1">### calcualte gyro radius</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</div>
</section>
<section id="Compare-the-Propagation-in-the-Perpendicular-Plane">
<h2>Compare the Propagation in the Perpendicular Plane<a class="headerlink" href="#Compare-the-Propagation-in-the-Perpendicular-Plane" title="Permalink to this headline"></a></h2>
<p>Here, we can compare the numerical results of both modules with the analytical solution of the particle trajectory. First, we want to show the trajectories in the <span class="math notranslate nohighlight">\(xy\)</span>-plane (left plot). The black squares present the positions of the analytical solution for the chosen step size. In the middle plot, we can display the relative error of the gyro radius as a function of time. Finally, we can compute the distance of the numerical solutions to the analytical solution in the <span class="math notranslate nohighlight">\(xy\)</span>-plane
(right plot).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">steps_per_gyrations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">number_gyrations</span> <span class="o">=</span> <span class="mi">40000</span>
<span class="n">number_of_steps</span> <span class="o">=</span> <span class="n">steps_per_gyrations</span> <span class="o">*</span> <span class="n">number_gyrations</span>

<span class="k">def</span> <span class="nf">plot_subplots</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">r_g</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="c1"># numerical calculated positions</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">module</span><span class="p">)</span>

    <span class="c1"># analytical solution shwon in black squares!</span>
    <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;CK&#39;</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
        <span class="c1"># for the legend</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Analytical solution&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># numerical solutions</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,(</span><span class="n">data</span><span class="o">.</span><span class="n">R</span><span class="o">-</span><span class="n">r_g</span><span class="p">)</span><span class="o">/</span><span class="n">r_g</span><span class="o">*</span><span class="mf">100.</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">module</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,((</span><span class="n">x_ana</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y_ana</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

 <span class="c1"># We use this function to plot the whole figure for the particle motion in the xy-plane</span>
<span class="k">def</span> <span class="nf">plot_figure_perp</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># for parallel motion corrected gyro radius</span>
    <span class="n">r_g</span> <span class="o">=</span> <span class="n">r_g_0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># Initial condition of candidate</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">p_y</span> <span class="o">=</span> <span class="n">p_x</span>

    <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span> <span class="o">=</span> <span class="n">analytical_solution</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_BP.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">r_g</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_CK.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">r_g</span><span class="p">,</span> <span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$ [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative error in $r_\mathrm</span><span class="si">{g}</span><span class="s1">$ [%]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$xy-$deviation from ana. solution [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We can study <strong>different pitch angles</strong> of the particle with respect to the background magnetic field and start with <span class="math notranslate nohighlight">\(p_z/p = 0.01\)</span> which represents a strong perpendicular component:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_perp</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.045074939727783s.
Simulation time with module BP is 1.3592238426208496s.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lmerten/Software/matrix/lib/python3.6/site-packages/ipykernel_launcher.py:58: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
/home/lmerten/Software/matrix/lib/python3.6/site-packages/IPython/core/pylabtools.py:132: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_18_2.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_18_2.png" />
</div>
</div>
<p>We increase the component of the momentum along the parallel component:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_perp</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 3.129796266555786s.
Simulation time with module BP is 3.1616051197052s.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lmerten/Software/matrix/lib/python3.6/site-packages/ipykernel_launcher.py:58: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_20_2.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_20_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_perp</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.7734830379486084s.
Simulation time with module BP is 2.4479715824127197s.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lmerten/Software/matrix/lib/python3.6/site-packages/ipykernel_launcher.py:58: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_21_2.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_21_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.9999</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_perp</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.7557637691497803s.
Simulation time with module BP is 2.5037429332733154s.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lmerten/Software/matrix/lib/python3.6/site-packages/ipykernel_launcher.py:58: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_22_2.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_22_2.png" />
</div>
</div>
<p><strong>Conclusions:</strong> - the <strong>Boris push</strong> propagates the particle in the perpendicular plane, as expected, on a cirlce with a radius that is in great agreement with the gyro radius. The problem is that the frequency deviates from the analytical solution. Consequently, even though we can see an agreement between the numerical and analytical gyro radius, the deviation in the <span class="math notranslate nohighlight">\(xy\)</span>-plane is between 0 and <span class="math notranslate nohighlight">\(2r_g\)</span>. The <strong>global error is constrained</strong>. - the <strong>Cash-Karp</strong> algorithm results in a
relative <strong>small local error</strong> in the perpendicular plane for small components of the momentum along the parallel component of the magnetic field. The problem is that the small <strong>local error accumulates to a large global error</strong>. In addition, the <strong>error depends on the pitch angle</strong> (angle between particle direction and background magnetic field) of the particle and thus may artificially pollute the results if we use a background field in combination with an isotropic source of particles.</p>
<ul class="simple">
<li><p>Note that other implementations of the CashKarp algorithm lead to different results, since CRPropa prevents the candidate from losing energy due to propagation alone. This is not true in general for other implementations.</p></li>
</ul>
</section>
<section id="Compare-the-Propagation-in-the-Parallel-Direction">
<h2>Compare the Propagation in the Parallel Direction<a class="headerlink" href="#Compare-the-Propagation-in-the-Parallel-Direction" title="Permalink to this headline"></a></h2>
<p>We now turn to the parallel direction of the particle trajectory with respect to the background magnetic field. Along this direction a constant momentum is expected, resulting in a linear increase of the <span class="math notranslate nohighlight">\(z\)</span>-position. This time-behavior of the <span class="math notranslate nohighlight">\(z\)</span>-position is shown in the middle plots below. The left plot presents the movement in the <span class="math notranslate nohighlight">\(xz\)</span>-plane. An rectangle is expected (as it can be seen for the Boris push). In the right, the difference between the numerically calculated and
theoretically expected time-behavior of the distance along the <span class="math notranslate nohighlight">\(z\)</span>-axis is plotted. Zero deviation in the right plot is preferable. While the Boris push has no deviation from the prediction, the Cash-Karp algorithm shows either a rapid increase in the <span class="math notranslate nohighlight">\(z\)</span>-direction or a decelerated movement which can result in a stagnation in the motion along the <span class="math notranslate nohighlight">\(z\)</span>-direction. The behavior depends on the ratio of <span class="math notranslate nohighlight">\(p_\mathrm{\parallel} / p\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_subplots_para</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">z_ana</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># compare with analytical solution</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="o">-</span><span class="n">z_ana</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_figure_para</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># for parallel motion corrected gyro radius</span>
    <span class="n">r_g</span> <span class="o">=</span> <span class="n">r_g_0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span> <span class="o">=</span> <span class="n">analytical_solution</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_BP.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots_para</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">z_ana</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_CK.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots_para</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">z_ana</span><span class="p">,</span> <span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$ [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$z$ [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$z$ [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;difference in $z$ [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We can again study <strong>different pitch angles</strong> of the particle with respect to the background magnetic field and start with <span class="math notranslate nohighlight">\(p_z/p = 0.01\)</span> which represents a strong perpendicular component:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_para</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.907780170440674s.
Simulation time with module BP is 2.5608789920806885s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_28_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_28_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_para</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.9700050354003906s.
Simulation time with module BP is 2.6082756519317627s.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lmerten/Software/matrix/lib/python3.6/site-packages/ipykernel_launcher.py:38: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
/home/lmerten/Software/matrix/lib/python3.6/site-packages/IPython/core/pylabtools.py:132: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_29_2.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_29_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_para</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.992185592651367s.
Simulation time with module BP is 2.4518914222717285s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_30_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_30_1.png" />
</div>
</div>
<p><strong>Conclusions:</strong> - the <strong>Boris push</strong> propagates the particle along the parallel component <strong>without any errors</strong> and is in great agreement with the analytical solution. - the behavior of the <strong>Cash-Karp</strong> on the other hand has again a <strong>small local error that accumulates to a large global error</strong>. Again, the <strong>error depends on the pitch angle</strong> of the particle and thus may artificially pollute the results if we use a background field in combination with a isotropic source (this source would
emit particles with all possible pitch angles) of particles.</p>
<p>If we are interested in the motion along the magnetic field lines, we should use the Boris push mehthod instead of the Cash-Karp method.</p>
</section>
<section id="Conservation-of-Momentum">
<h2>Conservation of Momentum<a class="headerlink" href="#Conservation-of-Momentum" title="Permalink to this headline"></a></h2>
<p>CRPropa conserves the total energy and momentum of each particle during the propagation. However, only the Boris push conserves energy by construction. Urging the Cash-Karp algorithm to preserve energy and momentum leads to a shift of the energy from the perpendicular to the parallel component (or the other way round) as observed in this example of a pure background magnetic field. We have seen that the particle accelerates or slows down in the parallel direction.</p>
<p>We can study this effect also directly by plotting the components of the momentum as functions of the time (or distance which is equivilent for relativistic particles <span class="math notranslate nohighlight">\(v=c\)</span>).</p>
<p>We expect to have a constant momentum in both the parallel (<span class="math notranslate nohighlight">\(p_z/p\)</span>) and the perpendicular (<span class="math notranslate nohighlight">\(\sqrt{p_x^2+p_y^2}/p\)</span>) direction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_subplots_momentum</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,((</span><span class="n">data</span><span class="o">.</span><span class="n">Px</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">data</span><span class="o">.</span><span class="n">Py</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">Pz</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,(</span><span class="n">data</span><span class="o">.</span><span class="n">Pz</span><span class="o">-</span><span class="n">p_z</span><span class="p">)</span><span class="o">/</span><span class="n">p_z</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># for parallel motion corrected gyro radius</span>
    <span class="n">r_g</span> <span class="o">=</span> <span class="n">r_g_0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span> <span class="o">=</span> <span class="n">analytical_solution</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>

    <span class="c1"># Initial condition of candidate</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">p_y</span> <span class="o">=</span> <span class="n">p_x</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_BP.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots_momentum</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_CK.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots_momentum</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\sqrt{p_x^2+p_y^2}/p$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$p_z/p$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;relative error in $p_z$ [%]&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We can start with small parallel component (<span class="math notranslate nohighlight">\(p_z\)</span> = 0.01)…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.8336169719696045s.
Simulation time with module BP is 2.5191328525543213s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_36_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_36_1.png" />
</div>
</div>
<p>…and increase it so that is already dominating <span class="math notranslate nohighlight">\(p_z/p = 0.5 &gt; p_x/p = p_y/p\)</span>…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 3.4364242553710938s.
Simulation time with module BP is 2.7046010494232178s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_38_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_38_1.png" />
</div>
</div>
<p>…and finally study two cases of really strong parallel motion (<span class="math notranslate nohighlight">\(p_z/p = 0.99\)</span> and <span class="math notranslate nohighlight">\(p_z/p = 0.999)\)</span>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.9141812324523926s.
Simulation time with module BP is 2.4687178134918213s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_40_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.9999</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 3.6175737380981445s.
Simulation time with module BP is 2.5163893699645996s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_41_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_41_1.png" />
</div>
</div>
<p><strong>Conclusions:</strong> - The <strong>Boris push</strong> conserves the components of the momentum because the algorithm already conserves energy by construction. - The <strong>Cash-Karp</strong> does not conserve energy by construction. CRPropa urges the propagation to conserve energy, resulting in a shift of the momentum between its components. This effect depends on the geometry of the magnetic field and the pitch angle (see above) of the particle as well as the step size (see below).</p>
<p>In the following two plots we can investigate the influence of the step size. We can consider for example 2 steps per gyration instead of 10 in the first figure and 50 steps per gyration in the second figure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 1.010209321975708s.
Simulation time with module BP is 0.5810580253601074s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_43_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_43_1.png" />
</div>
</div>
<p>If we increase the number of steps per gyration, we expect to minimize the error of the Cash-Karp algorithm. 50 steps per gyration lead to:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_momentum</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 16.289583444595337s.
Simulation time with module BP is 12.5268075466156s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_45_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_45_1.png" />
</div>
</div>
<p>The conservation of the momentum with the Boris push is independet of the number of steps per gyration and works always, while it strongly depend on this number for the Cash-Karp algorithm. As expected, only the Boris push preserves the components of the momentum correctly. 2 steps per gyrations lead imediately to a complete change of the momentum components. Instead of a parallel motion as expected from the initial condition (<span class="math notranslate nohighlight">\(p_z/p\)</span> = 0.99), the particle only moves in the perpendicular
plane (<span class="math notranslate nohighlight">\(p_z/p\)</span> = 0) after a short distance. The behavior is much better for 50 steps per gyration (the simulation time is, however, high). The error is small at the investigated distances. Feel free to test different numbers of gyrations and different numbers of steps per gyration.</p>
</section>
<section id="Comparison-with-3D-Analytic-Solution">
<h2>Comparison with 3D Analytic Solution<a class="headerlink" href="#Comparison-with-3D-Analytic-Solution" title="Permalink to this headline"></a></h2>
<p>We can study the complete deviation of the numerical trajectories from the analytical solution. The following code calculates the distance between the positions calculated with both algorithms and the analytical particle position.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_subplots_3d</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">D</span><span class="p">,((</span><span class="n">x_ana</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y_ana</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">z_ana</span><span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">module</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_figure_3d</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># for parallel motion corrected gyro radius</span>
    <span class="n">r_g</span> <span class="o">=</span> <span class="n">r_g_0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># Initial condition of candidate</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">p_y</span> <span class="o">=</span> <span class="n">p_x</span>

    <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span> <span class="o">=</span> <span class="n">analytical_solution</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_BP.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots_3d</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span><span class="p">,</span> <span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;trajectory_CK.txt&#39;</span><span class="p">,</span> <span class="n">r_g</span><span class="p">)</span>
    <span class="n">plot_subplots_3d</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x_ana</span><span class="p">,</span> <span class="n">y_ana</span><span class="p">,</span> <span class="n">z_ana</span><span class="p">,</span> <span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance [kpc]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$xyz-$deviation from analytical solution [pc]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$p_z/p$ = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p_z</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_3d</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 3.250000476837158s.
Simulation time with module BP is 2.8336546421051025s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_50_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_50_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_3d</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 3.026798725128174s.
Simulation time with module BP is 2.7702648639678955s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_51_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_51_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_3d</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.8276591300964355s.
Simulation time with module BP is 2.6629881858825684s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_52_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_52_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.9999</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_3d</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.818937301635742s.
Simulation time with module BP is 2.5782644748687744s.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_53_1.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_53_1.png" />
</div>
</div>
<p>The Boris push is for long simulations for all presented cases better and faster than the Cash-Karp algorithm. If we are only interested in small distances and we don’t care about long simulation times, the Cash-Karp algorithm outperforms the Boris push as presented below (40 steps per gyration and <span class="math notranslate nohighlight">\(p_z/p = 0.01\)</span>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p_z</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">,</span> <span class="n">steps_per_gyrations</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">number_gyrations</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">p_z</span><span class="p">)</span>
<span class="n">plot_figure_3d</span><span class="p">(</span><span class="n">max_trajectory</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">r_g_0</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 2.885383367538452s.
Simulation time with module BP is 2.626239061355591s.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lmerten/Software/matrix/lib/python3.6/site-packages/ipykernel_launcher.py:27: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
/home/lmerten/Software/matrix/lib/python3.6/site-packages/IPython/core/pylabtools.py:132: UserWarning: Creating legend with loc=&#34;best&#34; can be slow with large amounts of data.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_55_2.png" src="../../../_images/pages_example_notebooks_propagation_comparison_Propagation_Comparison_CK_BP_55_2.png" />
</div>
</div>
<p><strong>The main findings of this tutorial are highlighted:</strong> - The Cash-Karp algorithm has a small local error, which accumulates over time to a large global error. The components of the momentum are not conserved. Due to the small local error (for small step sizes), the module PropagationCK is, however, useful for short simulations, where the exact position is crucial. - The Boris push has a compareable large local error, which does not accumulate over time, resulting in a small global error. The
accuracy doesn’t depend too much on the step size, especially not in the direction where the magnetic field should have no influence based on alaytical arguments (<span class="math notranslate nohighlight">\(z\)</span>-axis in this example).</p>
<p>Therefore, for almost all simulation scenarios, <strong>the PropagationBP module outperforms the PropagationCK module in both simulation time and accuracy</strong>.</p>
</section>
<section id="Comparison-of-Simulation-Time">
<h2>Comparison of Simulation Time<a class="headerlink" href="#Comparison-of-Simulation-Time" title="Permalink to this headline"></a></h2>
<p>We have already compared the simulation times for a background magnetic field. Now we can compare the simulation time of both modules for a different magnetic field, namely the turbulent magnetic field. The Boris push calls the magnetic field only once per step, whereas the Cash-Karp algorithm needs the field at the current position six times per step. For analytical fields where the field is known at every location (for example the background magnetic field), the time difference is much smaller
than for magnetic fields where the current magnetic field vector has to be interpolated first. The latter is especially relevant for the turbulent magnetic fields initialized on grids.</p>
<section id="Turbulent-Magnetic-Field">
<h3>Turbulent Magnetic Field<a class="headerlink" href="#Turbulent-Magnetic-Field" title="Permalink to this headline"></a></h3>
<p>The inialisation of the turbulent magnetic field vectors on the grid points takes some time:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">### Setup turbulent magnetic field</span>
<span class="n">randomSeed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">lMin</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">pc</span>
<span class="n">lMax</span> <span class="o">=</span> <span class="mf">5.</span><span class="o">*</span><span class="n">pc</span>
<span class="n">N_grid</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">nG</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="n">lMin</span><span class="o">/</span><span class="mf">2.</span>
<span class="c1">#spacing = R / 2 *pc  # lMin &gt; 2 * spacing</span>
<span class="c1">#vgrid = Grid3f(Vector3d(0), N_grid, spacing)</span>
<span class="c1">#initTurbulence(vgrid, b, lMin, lMax, -11./3., randomSeed)</span>
<span class="c1">#turb_field = MagneticFieldGrid(vgrid)</span>

<span class="n">turbSpectrum</span> <span class="o">=</span> <span class="n">SimpleTurbulenceSpectrum</span><span class="p">(</span><span class="n">Brms</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">lMin</span><span class="o">=</span><span class="n">lMin</span><span class="p">,</span> <span class="n">lMax</span><span class="o">=</span><span class="n">lMax</span><span class="p">,</span> <span class="n">sIndex</span><span class="o">=</span><span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="n">gridprops</span> <span class="o">=</span> <span class="n">GridProperties</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">N_grid</span><span class="p">,</span> <span class="n">spacing</span><span class="p">)</span>
<span class="n">turb_field</span> <span class="o">=</span> <span class="n">SimpleGridTurbulence</span><span class="p">(</span><span class="n">turbSpectrum</span><span class="p">,</span> <span class="n">gridprops</span><span class="p">,</span> <span class="n">randomSeed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, we can run both propagation modules and compare their simulation times:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ### Running the simulation with either CK or BP</span>
<span class="k">def</span> <span class="nf">runSimulation</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">ModuleList</span><span class="p">()</span>
    <span class="n">steplength</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span><span class="n">pc</span>
    <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;CK&#39;</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationCK</span><span class="p">(</span><span class="n">turb_field</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">,</span><span class="n">steplength</span><span class="p">,</span> <span class="n">steplength</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;BP&#39;</span><span class="p">:</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationBP</span><span class="p">(</span><span class="n">turb_field</span><span class="p">,</span> <span class="n">steplength</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no module found. Use either BP or CK.&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">sim</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaximumTrajectoryLength</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">Mpc</span><span class="p">))</span>
    <span class="c1"># Proton</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Candidate</span><span class="p">(</span><span class="n">nucleusId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">100</span><span class="o">*</span><span class="n">TeV</span><span class="p">,</span> <span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">Vector3d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># compare the simulation time of both propagation methods</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation time with module </span><span class="si">{}</span><span class="s1"> is </span><span class="si">{:4.4}</span><span class="s1"> s.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
    <span class="n">Time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">runSimulation</span><span class="p">(</span><span class="s1">&#39;BP&#39;</span><span class="p">)</span>
<span class="n">runSimulation</span><span class="p">(</span><span class="s1">&#39;CK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module BP is 5.822 s.
Simulation time with module CK is 27.11 s.
</pre></div></div>
</div>
<p>The simulation time difference is really high! <strong>PropagationBP is much faster than PropagationCK for the turbulent magnetic field</strong>.</p>
</section>
</section>
<section id="Time-Comparison-for-Galactic-Trajectories">
<h2>Time Comparison for Galactic Trajectories<a class="headerlink" href="#Time-Comparison-for-Galactic-Trajectories" title="Permalink to this headline"></a></h2>
<p>Here, we test the time difference for the example of galactic trajectories presented in:</p>
<p><a class="reference external" href="https://github.com/CRPropa/CRPropa3-notebooks/blob/master/galactic_trajectories/galactic_trajectories.v4.ipynb">https://github.com/CRPropa/CRPropa3-notebooks/blob/master/galactic_trajectories/galactic_trajectories.v4.ipynb</a>.</p>
<p>First, we want to compare both modules with a fixed step size:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">crpropa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">Time</span>

<span class="c1"># magnetic field setup</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">JF12Field</span><span class="p">()</span>
<span class="n">randomSeed</span> <span class="o">=</span> <span class="mi">691342</span>
<span class="n">B</span><span class="o">.</span><span class="n">randomStriated</span><span class="p">(</span><span class="n">randomSeed</span><span class="p">)</span>
<span class="n">B</span><span class="o">.</span><span class="n">randomTurbulent</span><span class="p">(</span><span class="n">randomSeed</span><span class="p">)</span>

<span class="c1"># simulation setup for fixed step size</span>
<span class="n">sim_CK</span> <span class="o">=</span> <span class="n">ModuleList</span><span class="p">()</span>
<span class="n">sim_CK</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationCK</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">))</span>
<span class="n">sim_CK</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SphericalBoundary</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">kpc</span><span class="p">))</span>

<span class="n">sim_BP</span> <span class="o">=</span> <span class="n">ModuleList</span><span class="p">()</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationBP</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">))</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SphericalBoundary</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">kpc</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyTrajectoryOutput</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom trajectory output: i, x, y, z</span>
<span class="sd">    where i is a running cosmic ray number</span>
<span class="sd">    and x,y,z are the galactocentric coordinates in [kpc].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="n">Module</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#i</span><span class="se">\t</span><span class="s1">X</span><span class="se">\t</span><span class="s1">Y</span><span class="se">\t</span><span class="s1">Z</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">kpc</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">kpc</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isActive</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">output_CK</span> <span class="o">=</span> <span class="n">MyTrajectoryOutput</span><span class="p">(</span><span class="s1">&#39;galactic_trajectories_CK.txt&#39;</span><span class="p">)</span>
<span class="n">output_BP</span> <span class="o">=</span> <span class="n">MyTrajectoryOutput</span><span class="p">(</span><span class="s1">&#39;galactic_trajectories_BP.txt&#39;</span><span class="p">)</span>

<span class="n">sim_CK</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">output_CK</span><span class="p">)</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">output_BP</span><span class="p">)</span>

<span class="c1"># source setup</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">Source</span><span class="p">()</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourcePosition</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">kpc</span><span class="p">))</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourceIsotropicEmission</span><span class="p">())</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourceParticleType</span><span class="p">(</span><span class="o">-</span><span class="n">nucleusId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourceEnergy</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">EeV</span><span class="p">))</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sim_CK</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># backtrack 10 random cosmic rays</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation time with module CK is </span><span class="si">{:4.4}</span><span class="s1"> s.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
<span class="n">output_CK</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># flush particles to ouput file</span>

<span class="n">t2</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># backtrack 10 random cosmic rays</span>
<span class="n">t3</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation time with module BP is </span><span class="si">{:4.4}</span><span class="s1"> s.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t3</span><span class="o">-</span><span class="n">t2</span><span class="p">))</span>
<span class="n">output_BP</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># flush particles to ouput file</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 86.28928446769714s.
Simulation time with module BP is 44.579694986343384s.
</pre></div></div>
</div>
<p>PropagationBP is faster than PropagationCK for the same step sizes.</p>
<p>Finally we can test exactly the example presented in: <a class="reference external" href="https://github.com/CRPropa/CRPropa3-notebooks/blob/master/galactic_trajectories/galactic_trajectories.v4.ipynb">https://github.com/CRPropa/CRPropa3-notebooks/blob/master/galactic_trajectories/galactic_trajectories.v4.ipynb</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># magnetic field setup</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">JF12Field</span><span class="p">()</span>
<span class="n">randomSeed</span> <span class="o">=</span> <span class="mi">691342</span>
<span class="n">B</span><span class="o">.</span><span class="n">randomStriated</span><span class="p">(</span><span class="n">randomSeed</span><span class="p">)</span>
<span class="n">B</span><span class="o">.</span><span class="n">randomTurbulent</span><span class="p">(</span><span class="n">randomSeed</span><span class="p">)</span>

<span class="c1"># simulation setup for adaptive step size for the Cash-Karp algorithm</span>
<span class="n">sim_CK</span> <span class="o">=</span> <span class="n">ModuleList</span><span class="p">()</span>
<span class="n">sim_CK</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationCK</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">))</span>
<span class="n">sim_CK</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SphericalBoundary</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">kpc</span><span class="p">))</span>

<span class="c1"># simulation setup for adaptive step size for the Boris push algorithm with a higher tolerance</span>
<span class="c1"># so that it is as fast as the Cash-Karp algorithm.</span>
<span class="n">sim_BP</span> <span class="o">=</span> <span class="n">ModuleList</span><span class="p">()</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PropagationBP</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mf">2e-3</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">parsec</span><span class="p">))</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SphericalBoundary</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">kpc</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">MyTrajectoryOutput</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom trajectory output: i, x, y, z</span>
<span class="sd">    where i is a running cosmic ray number</span>
<span class="sd">    and x,y,z are the galactocentric coordinates in [kpc].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="n">Module</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#i</span><span class="se">\t</span><span class="s1">X</span><span class="se">\t</span><span class="s1">Y</span><span class="se">\t</span><span class="s1">Z</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">getPosition</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">kpc</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">kpc</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">kpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isActive</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">output_CK</span> <span class="o">=</span> <span class="n">MyTrajectoryOutput</span><span class="p">(</span><span class="s1">&#39;galactic_trajectories_CK.txt&#39;</span><span class="p">)</span>
<span class="n">output_BP</span> <span class="o">=</span> <span class="n">MyTrajectoryOutput</span><span class="p">(</span><span class="s1">&#39;galactic_trajectories_BP.txt&#39;</span><span class="p">)</span>

<span class="n">sim_CK</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">output_CK</span><span class="p">)</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">output_BP</span><span class="p">)</span>

<span class="c1"># source setup</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">Source</span><span class="p">()</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourcePosition</span><span class="p">(</span><span class="n">Vector3d</span><span class="p">(</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">kpc</span><span class="p">))</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourceIsotropicEmission</span><span class="p">())</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourceParticleType</span><span class="p">(</span><span class="o">-</span><span class="n">nucleusId</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">source</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SourceEnergy</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">EeV</span><span class="p">))</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sim_CK</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># backtrack 10 random cosmic rays</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation time with module CK is </span><span class="si">{:4.4}</span><span class="s1"> s.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
<span class="n">output_CK</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># flush particles to ouput file</span>

<span class="n">t2</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sim_BP</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># backtrack 10 random cosmic rays</span>
<span class="n">t3</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Simulation time with module BP is </span><span class="si">{:4.4}</span><span class="s1"> s.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t3</span><span class="o">-</span><span class="n">t2</span><span class="p">))</span>
<span class="n">output_BP</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># flush particles to ouput file</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulation time with module CK is 0.4632 s.
Simulation time with module BP is  0.6 s.
</pre></div></div>
</div>
<p>The simulation time depends on the tolerance. For the same tolerance, the PropagationCK is much faster than PropagationBP.</p>
<p>If the tolerance of the PropagationBP module is adjusted to 2e-3 (instead of 1e-4), both simulation times are the same. The big differences can be explained by the different orders of the algorithms. Whereas the Cash-Karp is a higher order algorithm, the Boris push is only of order 2.</p>
<p>[1] Hong Qin et al. “Why is Boris algorithm so good?” In: Physics of Plasmas 20.8 (2013), p. 084503. doi: 10.1063/1.4818428. url: <a class="reference external" href="https://doi.org/10.1063/1.4818428">https://doi.org/10.1063/1.4818428</a>.</p>
<p>[2] Mathias Winkel, Robert Speck, and Daniel Ruprecht. “Does Boris-SDC conserve phase space volume?” In: PAMM 15.1 (2015), pp. 687–688. doi: 10.1002/pamm.201510333. url: https: //onlinelibrary.wiley.com/doi/abs/10.1002/pamm.201510333.</p>
<p>[3] J. R. Cash and Alan H. Karp. “A Variable Order Runge-Kutta Method for Initial Value Problems with Rapidly Varying Right-hand Sides”. In: ACM Trans. Math. Softw. 16.3 (Sept. 1990), pp. 201–222. issn: 0098-3500. doi: 10.1145/79505.79507. url: <a class="reference external" href="http://doi.acm.org/10">http://doi.acm.org/10</a>. 1145/79505.79507.</p>
<p>[4] J. Boris, in Proc. of the 4th Conf. on Numerical Simulation of Plasmas (NRL, 1970), pp. 3-67.</p>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../Cpp-projects.html" class="btn btn-neutral float-left" title="Using CRPropa from C++" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../AdditionalResources.html" class="btn btn-neutral float-right" title="Additional Resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The CRPropa Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>