\hypertarget{MagneticLens_8h_source}{}\doxysection{Magnetic\+Lens.\+h}
\label{MagneticLens_8h_source}\index{MagneticLens.h@{MagneticLens.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{2 \textcolor{comment}{// This file is part of PARSEC (http://physik.rwth-\/aachen.de/parsec)}}
\DoxyCodeLine{3 \textcolor{comment}{// a parametrized simulation engine for cosmic rays.}}
\DoxyCodeLine{4 \textcolor{comment}{//}}
\DoxyCodeLine{5 \textcolor{comment}{// Copyright (C) 2011   Martin Erdmann, Peter Schiffer, Tobias Winchen}}
\DoxyCodeLine{6 \textcolor{comment}{//                                                                               RWTH Aachen University, Germany}}
\DoxyCodeLine{7 \textcolor{comment}{// Contact: winchen@physik.rwth-\/aachen.de}}
\DoxyCodeLine{8 \textcolor{comment}{//}}
\DoxyCodeLine{9 \textcolor{comment}{//      This program is free software: you can redistribute it and/or}}
\DoxyCodeLine{10 \textcolor{comment}{//      modify it under the terms of the GNU General Public License as}}
\DoxyCodeLine{11 \textcolor{comment}{//      published by the Free Software Foundation, either version 3 of}}
\DoxyCodeLine{12 \textcolor{comment}{//      the License, or (at your option) any later version.}}
\DoxyCodeLine{13 \textcolor{comment}{//}}
\DoxyCodeLine{14 \textcolor{comment}{//      This program is distributed in the hope that it will be useful,}}
\DoxyCodeLine{15 \textcolor{comment}{//      but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{16 \textcolor{comment}{//      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.    See the}}
\DoxyCodeLine{17 \textcolor{comment}{//      GNU General Public License for more details.}}
\DoxyCodeLine{18 \textcolor{comment}{//}}
\DoxyCodeLine{19 \textcolor{comment}{//      You should have received a copy of the GNU General Public License}}
\DoxyCodeLine{20 \textcolor{comment}{//      along with this program. If not, see <http://www.gnu.org/licenses/>.}}
\DoxyCodeLine{21 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#ifndef MAGNETICLENS\_HH}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define MAGNETICLENS\_HH}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}crpropa/magneticLens/ModelMatrix.h"{}}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}crpropa/magneticLens/Pixelization.h"{}}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{Units_8h}{crpropa/Units.h}}"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}crpropa/Vector3.h"{}}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <stdexcept>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 }
\DoxyCodeLine{40 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecrpropa}{crpropa}}}
\DoxyCodeLine{41 \{}
\DoxyCodeLine{42 }
\DoxyCodeLine{44 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1LensPart}{LensPart}}}
\DoxyCodeLine{45 \{}
\DoxyCodeLine{46         \textcolor{keywordtype}{string} \_filename;}
\DoxyCodeLine{47         \textcolor{keywordtype}{double} \_rigidityMin;}
\DoxyCodeLine{48         \textcolor{keywordtype}{double} \_rigidityMax;}
\DoxyCodeLine{49         ModelMatrixType M;}
\DoxyCodeLine{50         \textcolor{keywordtype}{double} \_maximumSumOfColumns;}
\DoxyCodeLine{51         \textcolor{keywordtype}{bool} \_maximumSumOfColumns\_calculated;}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{public}:}
\DoxyCodeLine{54         \mbox{\hyperlink{classcrpropa_1_1LensPart}{LensPart}}()}
\DoxyCodeLine{55         \{}
\DoxyCodeLine{56         \}}
\DoxyCodeLine{59         \mbox{\hyperlink{classcrpropa_1_1LensPart_a18788eb8b14b2d0b7235ff83cc0ba143}{LensPart}}(\textcolor{keyword}{const} std::string \&filename, \textcolor{keywordtype}{double} rigidityMin, \textcolor{keywordtype}{double} rigidityMax) :}
\DoxyCodeLine{60                         \_filename(filename), \_rigidityMin(rigidityMin), \_rigidityMax(rigidityMax), \_maximumSumOfColumns\_calculated(}
\DoxyCodeLine{61                                         false), \_maximumSumOfColumns(0)}
\DoxyCodeLine{62         \{}
\DoxyCodeLine{63         \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         \mbox{\hyperlink{classcrpropa_1_1LensPart}{\string~LensPart}}()}
\DoxyCodeLine{66         \{}
\DoxyCodeLine{67         \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{70         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1LensPart_aca3f30ba548f022ea7e10f747faa4ad3}{loadMatrixFromFile}}()}
\DoxyCodeLine{71         \{}
\DoxyCodeLine{72                 \mbox{\hyperlink{namespacecrpropa_a29dbf1e61010b4104941a96eaa846cf1}{deserialize}}(\_filename, M);}
\DoxyCodeLine{73         \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{76         \textcolor{keyword}{const} std::string\& \mbox{\hyperlink{classcrpropa_1_1LensPart_a4b667f85b4e1aa9f313dd9e14d5c50bd}{getFilename}}()}
\DoxyCodeLine{77         \{}
\DoxyCodeLine{78                 \textcolor{keywordflow}{return} \_filename;}
\DoxyCodeLine{79         \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{82         \textcolor{keywordtype}{double} \mbox{\hyperlink{classcrpropa_1_1LensPart_a7cea68bb54c53eb6f2993b0f7e1033e6}{getMaximumOfSumsOfColumns}}()}
\DoxyCodeLine{83         \{}
\DoxyCodeLine{84                 \textcolor{keywordflow}{if} (!\_maximumSumOfColumns\_calculated)}
\DoxyCodeLine{85                 \{ \textcolor{comment}{// lazy calculation of maximum}}
\DoxyCodeLine{86                         \_maximumSumOfColumns = \mbox{\hyperlink{namespacecrpropa_a2f6ed50a4dd5e68e6532340866a6819d}{maximumOfSumsOfColumns}}(M);}
\DoxyCodeLine{87                         \_maximumSumOfColumns\_calculated = \textcolor{keyword}{true};}
\DoxyCodeLine{88                 \}}
\DoxyCodeLine{89                 \textcolor{keywordflow}{return} \_maximumSumOfColumns;}
\DoxyCodeLine{90         \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{93         \textcolor{keywordtype}{double} \mbox{\hyperlink{classcrpropa_1_1LensPart_ad423eab87366c36f645cae0e74942964}{getMinimumRigidity}}()}
\DoxyCodeLine{94         \{}
\DoxyCodeLine{95                 \textcolor{keywordflow}{return} \_rigidityMin / eV;}
\DoxyCodeLine{96         \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{99         \textcolor{keywordtype}{double} \mbox{\hyperlink{classcrpropa_1_1LensPart_a68719994e58459f268bd04a1327ce769}{getMaximumRigidity}}()}
\DoxyCodeLine{100         \{}
\DoxyCodeLine{101                 \textcolor{keywordflow}{return} \_rigidityMax / eV;}
\DoxyCodeLine{102         \}}
\DoxyCodeLine{103 }
\DoxyCodeLine{105         ModelMatrixType\& \mbox{\hyperlink{classcrpropa_1_1LensPart_ad882b47af373b43434a01c2bf589d431}{getMatrix}}()}
\DoxyCodeLine{106         \{}
\DoxyCodeLine{107                 \textcolor{keywordflow}{return} M;}
\DoxyCodeLine{108         \}}
\DoxyCodeLine{109 }
\DoxyCodeLine{111         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1LensPart_a7321d3fb69643e60a9de9eefaeadacc7}{setMatrix}}(\textcolor{keyword}{const} ModelMatrixType\& m)}
\DoxyCodeLine{112         \{}
\DoxyCodeLine{113                 M = m;}
\DoxyCodeLine{114         \}}
\DoxyCodeLine{115 }
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \};}
\DoxyCodeLine{118 }
\DoxyCodeLine{120 \textcolor{comment}{//double calculateMeanDeflection(const ModelMatrix \&M,}}
\DoxyCodeLine{121 \textcolor{comment}{//              const Pixelization \&pixelization)}}
\DoxyCodeLine{122 \textcolor{comment}{//\{}}
\DoxyCodeLine{123 \textcolor{comment}{//      double totalDeflection = 0;}}
\DoxyCodeLine{124 \textcolor{comment}{//      double weightSum = 0;}}
\DoxyCodeLine{125 \textcolor{comment}{//      for (const\_i2\_t it1 = M.begin2(); it1 != (M.end2()); it1++)}}
\DoxyCodeLine{126 \textcolor{comment}{//      \{}}
\DoxyCodeLine{127 \textcolor{comment}{//              for (const\_i1\_t it2 = it1.begin(); it2 != it1.end(); it2++)}}
\DoxyCodeLine{128 \textcolor{comment}{//              \{}}
\DoxyCodeLine{129 \textcolor{comment}{//                      totalDeflection+= pixelization.angularDistance(it2.index1(),}}
\DoxyCodeLine{130 \textcolor{comment}{//                                      it2.index2()) * (*it2) ;}}
\DoxyCodeLine{131 \textcolor{comment}{//                      weightSum+= (*it2);}}
\DoxyCodeLine{132 \textcolor{comment}{//              \}}}
\DoxyCodeLine{133 \textcolor{comment}{//      \}}}
\DoxyCodeLine{134 \textcolor{comment}{//      return totalDeflection / weightSum;}}
\DoxyCodeLine{135 \textcolor{comment}{//\}}}
\DoxyCodeLine{136 }
\DoxyCodeLine{137 \textcolor{keyword}{typedef} std::vector<LensPart*>::iterator \mbox{\hyperlink{namespacecrpropa_af135df255ba94df054e3289a0526f3b3}{LensPartIter}};}
\DoxyCodeLine{138 \textcolor{keyword}{typedef} std::vector<LensPart*>::const\_iterator const\_LensPartIter;}
\DoxyCodeLine{139 }
\DoxyCodeLine{147 \textcolor{keyword}{class }\mbox{\hyperlink{classcrpropa_1_1MagneticLens}{MagneticLens}}}
\DoxyCodeLine{148 \{}
\DoxyCodeLine{149 }
\DoxyCodeLine{150         \textcolor{keywordtype}{void} updateRigidityBounds(\textcolor{keywordtype}{double} rigidityMin, \textcolor{keywordtype}{double} rigidityMax);}
\DoxyCodeLine{151 }
\DoxyCodeLine{153         \textcolor{keywordtype}{void} loadLensPart(\textcolor{keyword}{const} \textcolor{keywordtype}{string} \&filename, \textcolor{keywordtype}{double} rigidityMin,}
\DoxyCodeLine{154                         \textcolor{keywordtype}{double} rigidityMax);}
\DoxyCodeLine{155 }
\DoxyCodeLine{156         \textcolor{comment}{// Stores the individual lenses}}
\DoxyCodeLine{157         std::vector<LensPart*> \_lensParts;}
\DoxyCodeLine{158         \mbox{\hyperlink{classcrpropa_1_1Pixelization}{Pixelization}}* \_pixelization;}
\DoxyCodeLine{159         \textcolor{comment}{// Checks Matrix, raises Errors if not ok -\/ also generate}}
\DoxyCodeLine{160         \textcolor{comment}{// \_pixelization if called first time}}
\DoxyCodeLine{161         \textcolor{keywordtype}{void} \_checkMatrix(\textcolor{keyword}{const} ModelMatrixType \&M);}
\DoxyCodeLine{162         \textcolor{comment}{// minimum / maximum rigidity that is covered by the lens [Joule]}}
\DoxyCodeLine{163         \textcolor{keywordtype}{double} \_minimumRigidity;}
\DoxyCodeLine{164         \textcolor{keywordtype}{double} \_maximumRigidity;}
\DoxyCodeLine{165         \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \_randomSeeded;}
\DoxyCodeLine{166         \textcolor{keywordtype}{double} \_norm;}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{keyword}{public}:}
\DoxyCodeLine{170         \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a643cd62aed5c704da458d60bb603c326}{MagneticLens}}() :}
\DoxyCodeLine{171                         \_pixelization(NULL), \_minimumRigidity(DBL\_MAX), \_maximumRigidity(DBL\_MIN), \_norm(1)}
\DoxyCodeLine{172         \{}
\DoxyCodeLine{173         \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{176         \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a00fe2b9e680ef54314604383f4ad5543}{MagneticLens}}(uint8\_t healpixorder) :}
\DoxyCodeLine{177                         \_pixelization(NULL), \_minimumRigidity(DBL\_MAX), \_maximumRigidity(DBL\_MIN)}
\DoxyCodeLine{178         \{}
\DoxyCodeLine{179                 \_pixelization = \textcolor{keyword}{new} \mbox{\hyperlink{classcrpropa_1_1Pixelization}{Pixelization}}(healpixorder);}
\DoxyCodeLine{180         \}}
\DoxyCodeLine{181 }
\DoxyCodeLine{183         \mbox{\hyperlink{classcrpropa_1_1MagneticLens_afe8b3bb801ef96e978ddab414f8535cc}{MagneticLens}}(\textcolor{keyword}{const} \textcolor{keywordtype}{string} \&filename) :}
\DoxyCodeLine{184                         \_pixelization(NULL), \_minimumRigidity(DBL\_MAX), \_maximumRigidity(DBL\_MIN)}
\DoxyCodeLine{185         \{}
\DoxyCodeLine{186                 \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a47603966d403181b3bfd4577f4142ab3}{loadLens}}(filename);}
\DoxyCodeLine{187         \}}
\DoxyCodeLine{188 }
\DoxyCodeLine{190         \textcolor{keyword}{const} \mbox{\hyperlink{classcrpropa_1_1Pixelization}{Pixelization}}\& \mbox{\hyperlink{classcrpropa_1_1MagneticLens_aa6211e3c3afbb6179ed595c164c59814}{getPixelization}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{191 \textcolor{keyword}{        }\{}
\DoxyCodeLine{192                 \textcolor{keywordflow}{return} (*\_pixelization);}
\DoxyCodeLine{193         \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{196         \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a38c98dc48a252726583c5c23ada3d358}{\string~MagneticLens}}()}
\DoxyCodeLine{197         \{}
\DoxyCodeLine{198                 \textcolor{keywordflow}{if} (\_pixelization)}
\DoxyCodeLine{199                         \textcolor{keyword}{delete} \_pixelization;}
\DoxyCodeLine{200                 \textcolor{keywordflow}{for} (std::vector<LensPart*>::iterator iter = \_lensParts.begin();}
\DoxyCodeLine{201                                 iter != \_lensParts.end(); iter++)}
\DoxyCodeLine{202                 \{}
\DoxyCodeLine{203                         \textcolor{keyword}{delete} (*iter);}
\DoxyCodeLine{204                 \}}
\DoxyCodeLine{205                 \_lensParts.clear();}
\DoxyCodeLine{206         \}}
\DoxyCodeLine{207 }
\DoxyCodeLine{212         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a7854f867ce85aed7cf05a4de7e3aae16}{transformCosmicRay}}(\textcolor{keywordtype}{double} rigidity, \textcolor{keywordtype}{double}\& phi, \textcolor{keywordtype}{double}\& theta);}
\DoxyCodeLine{213 }
\DoxyCodeLine{215         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_aaf082f466e832093d83553dcc1d90908}{transformCosmicRay}}(\textcolor{keywordtype}{double} rigidity, \mbox{\hyperlink{classcrpropa_1_1Vector3}{Vector3d}} \&p);}
\DoxyCodeLine{216 }
\DoxyCodeLine{219         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a162c9d22dd25910cd5e8cc622c943407}{transformModelVector}}(\textcolor{keywordtype}{double}* model, \textcolor{keywordtype}{double} rigidity) \textcolor{keyword}{const};}
\DoxyCodeLine{220 }
\DoxyCodeLine{223         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_ade6860693addc8f4585314d4a2456129}{setLensPart}}(\textcolor{keyword}{const} ModelMatrixType \&M, \textcolor{keywordtype}{double} rigidityMin, \textcolor{keywordtype}{double} rigidityMax);}
\DoxyCodeLine{224 }
\DoxyCodeLine{228         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a47603966d403181b3bfd4577f4142ab3}{loadLens}}(\textcolor{keyword}{const} \textcolor{keywordtype}{string} \&filename);}
\DoxyCodeLine{229 }
\DoxyCodeLine{232         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_ae988fb8fef9974c11ef93767120e6df5}{normalizeLens}}();}
\DoxyCodeLine{233 }
\DoxyCodeLine{237         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a46e75afd0737b2785de34fe0906dcf8a}{normalizeLensparts}}();}
\DoxyCodeLine{238 }
\DoxyCodeLine{240         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a09e126e579c0e758fa82a2567580a816}{rigidityCovered}}(\textcolor{keywordtype}{double} rigidity) \textcolor{keyword}{const};}
\DoxyCodeLine{241 }
\DoxyCodeLine{244         \textcolor{keywordtype}{void} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_aa4d2ede0ccac44aa936592ea2c37d21d}{normalizeMatrixColumns}}();}
\DoxyCodeLine{245 }
\DoxyCodeLine{247         \textcolor{keywordtype}{double} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a56a78b6e6cc179b886e66d15af90b0f0}{getMinimumRigidity}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{248 \textcolor{keyword}{        }\{}
\DoxyCodeLine{249                 \textcolor{keywordflow}{return} \_minimumRigidity / eV;}
\DoxyCodeLine{250         \}}
\DoxyCodeLine{252         \textcolor{keywordtype}{double} \mbox{\hyperlink{classcrpropa_1_1MagneticLens_aa189be38fadf10bca005ac2326536de4}{getMaximumRigidity}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{253 \textcolor{keyword}{        }\{}
\DoxyCodeLine{254                 \textcolor{keywordflow}{return} \_maximumRigidity / eV;}
\DoxyCodeLine{255         \}}
\DoxyCodeLine{256 }
\DoxyCodeLine{257         \textcolor{comment}{//      returns the norm used for the lenses}}
\DoxyCodeLine{258         \textcolor{keywordtype}{double} getNorm()}
\DoxyCodeLine{259         \{}
\DoxyCodeLine{260                 \textcolor{keywordflow}{return} \_norm;}
\DoxyCodeLine{261         \}}
\DoxyCodeLine{262 }
\DoxyCodeLine{264         \mbox{\hyperlink{classcrpropa_1_1LensPart}{LensPart}}* \mbox{\hyperlink{classcrpropa_1_1MagneticLens_a1bdf8cddf4c8587eafb11493758ed857}{getLensPart}}(\textcolor{keywordtype}{double} rigidity) \textcolor{keyword}{const};}
\DoxyCodeLine{265 }
\DoxyCodeLine{267         \textcolor{keyword}{const} std::vector<LensPart*>\& \mbox{\hyperlink{classcrpropa_1_1MagneticLens_aabdb173f5ca5b7409511f4ce31d9a46d}{getLensParts}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{268 \textcolor{keyword}{        }\{}
\DoxyCodeLine{269                 \textcolor{keywordflow}{return} \_lensParts;}
\DoxyCodeLine{270         \}}
\DoxyCodeLine{271 \};}
\DoxyCodeLine{272 }
\DoxyCodeLine{274 \} \textcolor{comment}{// namespace}}
\DoxyCodeLine{275 }
\DoxyCodeLine{276 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// MAGNETICLENS\_HH}}

\end{DoxyCode}
